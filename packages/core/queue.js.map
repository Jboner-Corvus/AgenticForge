{"version":3,"file":"queue.js","sourceRoot":"","sources":["queue.ts"],"names":[],"mappings":"AAAA,yBAAyB;AACzB,OAAO,EAAE,KAAK,EAAE,MAAM,QAAQ,CAAC;AAC/B,OAAO,EAAE,KAAK,EAAE,MAAM,SAAS,CAAC;AAEhC,OAAO,EAAE,MAAM,EAAE,MAAM,aAAa,CAAC;AACrC,OAAO,MAAM,MAAM,aAAa,CAAC;AAGjC,qDAAqD;AACrD,MAAM,CAAC,MAAM,eAAe,GAAG,IAAI,KAAK,CACtC,MAAM,CAAC,UAAU,EACjB,MAAM,CAAC,UAAU,EACjB;IACE,oBAAoB,EAAE,IAAI;CAC3B,CACF,CAAC;AAWF,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAI,KAAK,CAAC,OAAO,EAAE,EAAE,UAAU,EAAE,eAAe,EAAE,CAAC,CAAC;AAC5E,qDAAqD;AACrD,MAAM,CAAC,MAAM,eAAe,GAAG,IAAI,KAAK,CAAC,cAAc,EAAE;IACvD,UAAU,EAAE,eAAe;CAC5B,CAAC,CAAC;AAEH,QAAQ,CAAC,EAAE,CAAC,OAAO,EAAE,CAAC,GAAU,EAAE,EAAE;IAClC,MAAM,CAAC,KAAK,CAAC,EAAE,GAAG,EAAE,EAAE,iBAAiB,CAAC,CAAC;AAC3C,CAAC,CAAC,CAAC","sourcesContent":["// FICHIER : src/queue.ts\nimport { Queue } from 'bullmq';\nimport { Redis } from 'ioredis';\n\nimport { config } from './config.js';\nimport logger from './logger.js';\nimport { SessionData } from './types.js';\n\n// CORRIGÉ : 'redisConnection' est maintenant exporté\nexport const redisConnection = new Redis(\n  config.REDIS_PORT,\n  config.REDIS_HOST,\n  {\n    maxRetriesPerRequest: null,\n  },\n);\n\n// CORRIGÉ : 'taskQueue' est maintenant exporté\nexport interface AsyncTaskJobPayload<TParams> {\n  auth: SessionData | undefined;\n  cbUrl?: string;\n  params: TParams;\n  taskId: string;\n  toolName: string;\n}\n\nexport const jobQueue = new Queue('tasks', { connection: redisConnection });\n// CORRIGÉ : 'deadLetterQueue' est maintenant exporté\nexport const deadLetterQueue = new Queue('dead-letters', {\n  connection: redisConnection,\n});\n\njobQueue.on('error', (err: Error) => {\n  logger.error({ err }, 'Job queue error');\n});\n"]}