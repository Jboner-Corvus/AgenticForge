
> @gforge/core@1.0.383 test:integration /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core
> vitest run --mode integration --run


 RUN  v3.2.4 /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core

 â¯ src/worker.concurrent.processing.integration.test.ts (9 tests | 3 failed) 1128ms
   âœ“ Worker Concurrent Processing Integration Tests > should create and manage worker pool 8ms
   Ã— Worker Concurrent Processing Integration Tests > should distribute jobs across workers concurrently 12ms
     â†’ No available workers
   Ã— Worker Concurrent Processing Integration Tests > should handle worker failures gracefully 58ms
     â†’ expected 'rejected' to be 'fulfilled' // Object.is equality
   âœ“ Worker Concurrent Processing Integration Tests > should implement job priority queue 54ms
   âœ“ Worker Concurrent Processing Integration Tests > should handle concurrent job processing with rate limiting 102ms
   Ã— Worker Concurrent Processing Integration Tests > should implement worker load balancing 3ms
     â†’ No available workers
   âœ“ Worker Concurrent Processing Integration Tests > should handle worker memory management 55ms
   âœ“ Worker Concurrent Processing Integration Tests > should implement job retry mechanism with exponential backoff  633ms
   âœ“ Worker Concurrent Processing Integration Tests > should monitor worker pool health and performance 200ms
 â¯ src/modules/agent/monitoring.integration.test.ts (19 tests | 15 failed) 1039ms
   Ã— Monitoring and Observability Integration Tests > Metrics Collection > should collect agent execution metrics 38ms
     â†’ expected "spy" to be called at least once
   Ã— Monitoring and Observability Integration Tests > Metrics Collection > should track LLM provider performance metrics 684ms
     â†’ The requested module 'pino' does not provide an export named 'Logger'
   Ã— Monitoring and Observability Integration Tests > Metrics Collection > should monitor tool execution statistics 30ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/utils/llmProvider.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/monitoring.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

   Ã— Monitoring and Observability Integration Tests > Distributed Tracing > should create distributed traces for agent workflows 9ms
     â†’ expected "spy" to be called at least once
   Ã— Monitoring and Observability Integration Tests > Distributed Tracing > should trace cross-service communications 18ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/redis/redisClient.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/monitoring.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

   Ã— Monitoring and Observability Integration Tests > Distributed Tracing > should correlate traces across agent instances 14ms
     â†’ expected "spy" to be called at least once
   Ã— Monitoring and Observability Integration Tests > Health Monitoring > should report agent health status 10ms
     â†’ expected "spy" to be called at least once
   Ã— Monitoring and Observability Integration Tests > Health Monitoring > should detect and report degraded performance 34ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/utils/llmProvider.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/monitoring.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

   âœ“ Monitoring and Observability Integration Tests > Health Monitoring > should monitor resource utilization 11ms
   Ã— Monitoring and Observability Integration Tests > Error Tracking and Alerting > should track and categorize errors 57ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/utils/llmProvider.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/monitoring.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

   Ã— Monitoring and Observability Integration Tests > Error Tracking and Alerting > should generate alerts for critical failures 30ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/utils/llmProvider.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/monitoring.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

   Ã— Monitoring and Observability Integration Tests > Error Tracking and Alerting > should implement error rate monitoring 10ms
     â†’ expected "spy" to be called at least once
   Ã— Monitoring and Observability Integration Tests > Performance Analytics > should analyze conversation quality metrics 16ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/redis/redisClient.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/monitoring.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

   âœ“ Monitoring and Observability Integration Tests > Performance Analytics > should track usage patterns and trends 7ms
   âœ“ Monitoring and Observability Integration Tests > Performance Analytics > should generate performance insights and recommendations 8ms
   Ã— Monitoring and Observability Integration Tests > Real-time Dashboards and Visualization > should provide real-time metrics for dashboards 8ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/redis/redisClient.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/monitoring.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

   Ã— Monitoring and Observability Integration Tests > Real-time Dashboards and Visualization > should stream metrics to visualization tools 8ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/redis/redisClient.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/monitoring.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

   Ã— Monitoring and Observability Integration Tests > Compliance and Audit Logging > should maintain detailed audit trails 9ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/redis/redisClient.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/monitoring.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

   âœ“ Monitoring and Observability Integration Tests > Compliance and Audit Logging > should ensure data retention compliance 31ms
 â¯ src/modules/agent/llmProvider.integration.test.ts (18 tests | 18 failed) 1269ms
   Ã— LLM Provider Fallback Integration Tests > Provider Failover Scenarios > should fallback from OpenAI to Anthropic on error 189ms
     â†’ mockResponseSchema.parse.mockReturnValue is not a function
   Ã— LLM Provider Fallback Integration Tests > Provider Failover Scenarios > should cascade through all providers on sequential failures 7ms
     â†’ mockResponseSchema.parse.mockReturnValue is not a function
   Ã— LLM Provider Fallback Integration Tests > Provider Failover Scenarios > should handle Qwen timeout errors with specific retry logic 8ms
     â†’ mockResponseSchema.parse.mockReturnValue is not a function
   Ã— LLM Provider Fallback Integration Tests > Provider Failover Scenarios > should handle all providers failing gracefully 36ms
     â†’ expected 'Agent run failed: this.log.child is nâ€¦' to contain 'All LLM providers failed'
   Ã— LLM Provider Fallback Integration Tests > Provider Health Monitoring > should monitor provider response times 7ms
     â†’ mockResponseSchema.parse.mockReturnValue is not a function
   Ã— LLM Provider Fallback Integration Tests > Provider Health Monitoring > should track provider error rates 10ms
     â†’ mockResponseSchema.parse.mockReturnValue is not a function
   Ã— LLM Provider Fallback Integration Tests > Provider Health Monitoring > should implement circuit breaker pattern for unhealthy providers 7ms
     â†’ mockResponseSchema.parse.mockReturnValue is not a function
   Ã— LLM Provider Fallback Integration Tests > Provider Load Balancing > should distribute load across healthy providers 8ms
     â†’ mockResponseSchema.parse.mockReturnValue is not a function
   Ã— LLM Provider Fallback Integration Tests > Provider Load Balancing > should respect provider priority in hierarchy 9ms
     â†’ mockResponseSchema.parse.mockReturnValue is not a function
   Ã— LLM Provider Fallback Integration Tests > Provider Load Balancing > should handle provider capacity limits 12ms
     â†’ mockResponseSchema.parse.mockReturnValue is not a function
   Ã— LLM Provider Fallback Integration Tests > Provider Recovery and Auto-healing > should automatically recover failed providers 22ms
     â†’ mockResponseSchema.parse.mockReturnValue is not a function
   Ã— LLM Provider Fallback Integration Tests > Provider Recovery and Auto-healing > should perform health checks on recovered providers 767ms
     â†’ The requested module 'pino' does not provide an export named 'Logger'
   Ã— LLM Provider Fallback Integration Tests > Provider Recovery and Auto-healing > should gradually increase traffic to recovered providers 17ms
     â†’ mockResponseSchema.parse.mockReturnValue is not a function
   Ã— LLM Provider Fallback Integration Tests > Provider-Specific Error Handling > should handle OpenAI-specific errors correctly 8ms
     â†’ mockResponseSchema.parse.mockReturnValue is not a function
   Ã— LLM Provider Fallback Integration Tests > Provider-Specific Error Handling > should handle Anthropic-specific errors correctly 7ms
     â†’ mockResponseSchema.parse.mockReturnValue is not a function
   Ã— LLM Provider Fallback Integration Tests > Provider-Specific Error Handling > should handle provider authentication failures 70ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/llm/LlmKeyManager.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/llmProvider.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

   Ã— LLM Provider Fallback Integration Tests > Cost Optimization > should prefer cost-effective providers when possible 46ms
     â†’ mockResponseSchema.parse.mockReturnValue is not a function
   Ã— LLM Provider Fallback Integration Tests > Cost Optimization > should track token usage and costs per provider 34ms
     â†’ mockResponseSchema.parse.mockReturnValue is not a function
 â¯ src/modules/agent/jobQueue.integration.test.ts (25 tests | 12 failed) 1289ms
   âœ“ Job Queue BullMQ Integration Tests > Job Creation and Processing > should create and process a basic job 10ms
   Ã— Job Queue BullMQ Integration Tests > Job Creation and Processing > should process job with proper progress updates 33ms
     â†’ expected "spy" to be called at least once
   Ã— Job Queue BullMQ Integration Tests > Job Creation and Processing > should handle high-priority jobs first 14ms
     â†’ expected "spy" to be called with arguments: [ [ 'waiting', 'active' ], +0, 100 ][90m

Number of calls: [1m0[22m
[39m
   âœ“ Job Queue BullMQ Integration Tests > Job Creation and Processing > should handle delayed job execution 6ms
   Ã— Job Queue BullMQ Integration Tests > Job Retry and Error Handling > should retry failed jobs with exponential backoff 670ms
     â†’ The requested module 'pino' does not provide an export named 'Logger'
   Ã— Job Queue BullMQ Integration Tests > Job Retry and Error Handling > should move job to failed queue after max retries 41ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/utils/llmProvider.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/jobQueue.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

   Ã— Job Queue BullMQ Integration Tests > Job Retry and Error Handling > should handle job timeout gracefully 28ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/utils/llmProvider.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/jobQueue.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

   Ã— Job Queue BullMQ Integration Tests > Job Retry and Error Handling > should provide detailed error diagnostics for failed jobs 43ms
     â†’ TypeScript parameter property is not supported in strip-only mode
   Ã— Job Queue BullMQ Integration Tests > Job Queue Management > should monitor queue health and metrics 33ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/redis/redisClient.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/jobQueue.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

   âœ“ Job Queue BullMQ Integration Tests > Job Queue Management > should clean up completed and failed jobs 123ms
   Ã— Job Queue BullMQ Integration Tests > Job Queue Management > should handle queue overflow and backpressure 13ms
     â†’ expected "spy" to be called at least once
   âœ“ Job Queue BullMQ Integration Tests > Job Queue Management > should support job prioritization and scheduling 10ms
   âœ“ Job Queue BullMQ Integration Tests > Repeatable and Scheduled Jobs > should create repeatable jobs with cron patterns 15ms
   Ã— Job Queue BullMQ Integration Tests > Repeatable and Scheduled Jobs > should manage repeatable job lifecycle 23ms
     â†’ expected "spy" to be called at least once
   âœ“ Job Queue BullMQ Integration Tests > Repeatable and Scheduled Jobs > should handle timezone-aware scheduling 12ms
   âœ“ Job Queue BullMQ Integration Tests > Job Dependencies and Workflows > should handle job dependencies and chains 4ms
   âœ“ Job Queue BullMQ Integration Tests > Job Dependencies and Workflows > should handle parallel job execution within workflows 10ms
   âœ“ Job Queue BullMQ Integration Tests > Job Dependencies and Workflows > should handle workflow failure recovery 9ms
   âœ“ Job Queue BullMQ Integration Tests > Queue Events and Monitoring > should handle queue events properly 26ms
   âœ“ Job Queue BullMQ Integration Tests > Queue Events and Monitoring > should emit progress events during job execution 35ms
   Ã— Job Queue BullMQ Integration Tests > Queue Events and Monitoring > should monitor queue performance metrics 46ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/redis/redisClient.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/jobQueue.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

   Ã— Job Queue BullMQ Integration Tests > Queue Events and Monitoring > should alert on queue anomalies 30ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/redis/redisClient.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/jobQueue.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

   Ã— Job Queue BullMQ Integration Tests > Queue Scaling and Load Balancing > should scale workers based on queue load 32ms
     â†’ expected 1 to be greater than 3
   âœ“ Job Queue BullMQ Integration Tests > Queue Scaling and Load Balancing > should distribute jobs across multiple queues 10ms
   âœ“ Job Queue BullMQ Integration Tests > Queue Scaling and Load Balancing > should handle queue failover between Redis instances 5ms
 â¯ src/modules/agent/llm.qwen.integration.test.ts (17 tests | 17 failed) 1320ms
   Ã— Qwen LLM Provider Integration Tests > Qwen Basic Integration > should successfully get response from Qwen provider 207ms
     â†’ mockResponseSchema.parse.mockReturnValue is not a function
   Ã— Qwen LLM Provider Integration Tests > Qwen Basic Integration > should handle Qwen API key validation 152ms
     â†’ The requested module 'pino' does not provide an export named 'Logger'
   Ã— Qwen LLM Provider Integration Tests > Qwen Basic Integration > should handle missing Qwen API key gracefully 58ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/llm/LlmKeyManager.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/llm.qwen.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

   Ã— Qwen LLM Provider Integration Tests > Qwen Error Handling > should handle Qwen rate limiting errors 38ms
     â†’ mockResponseSchema.parse.mockReturnValue is not a function
   Ã— Qwen LLM Provider Integration Tests > Qwen Error Handling > should handle Qwen timeout errors with retries 43ms
     â†’ mockResponseSchema.parse.mockReturnValue is not a function
   Ã— Qwen LLM Provider Integration Tests > Qwen Error Handling > should handle Qwen API authentication errors 66ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/llm/LlmKeyManager.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/llm.qwen.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

   Ã— Qwen LLM Provider Integration Tests > Qwen Error Handling > should handle Qwen service unavailable errors 28ms
     â†’ mockResponseSchema.parse.mockReturnValue is not a function
   Ã— Qwen LLM Provider Integration Tests > Qwen Model Selection and Configuration > should work with different Qwen model variants 24ms
     â†’ mockResponseSchema.parse.mockReturnValue is not a function
   Ã— Qwen LLM Provider Integration Tests > Qwen Model Selection and Configuration > should respect Qwen temperature and token limits 26ms
     â†’ mockResponseSchema.parse.mockReturnValue is not a function
   Ã— Qwen LLM Provider Integration Tests > Qwen Model Selection and Configuration > should handle Qwen streaming responses 50ms
     â†’ mockResponseSchema.parse.mockReturnValue is not a function
   Ã— Qwen LLM Provider Integration Tests > Qwen Performance and Monitoring > should monitor Qwen response times 28ms
     â†’ mockResponseSchema.parse.mockReturnValue is not a function
   Ã— Qwen LLM Provider Integration Tests > Qwen Performance and Monitoring > should track Qwen token usage 19ms
     â†’ mockResponseSchema.parse.mockReturnValue is not a function
   Ã— Qwen LLM Provider Integration Tests > Qwen Performance and Monitoring > should implement Qwen health checks 505ms
     â†’ request for '../../config.ts' is not in cache
   Ã— Qwen LLM Provider Integration Tests > Qwen Context and Memory Management > should handle long conversation context with Qwen 23ms
     â†’ mockResponseSchema.parse.mockReturnValue is not a function
   Ã— Qwen LLM Provider Integration Tests > Qwen Context and Memory Management > should optimize context window for Qwen models 8ms
     â†’ mockResponseSchema.parse.mockReturnValue is not a function
   Ã— Qwen LLM Provider Integration Tests > Qwen Cost Optimization > should track Qwen usage costs 14ms
     â†’ mockResponseSchema.parse.mockReturnValue is not a function
   Ã— Qwen LLM Provider Integration Tests > Qwen Cost Optimization > should prefer Qwen for cost-effective operations 19ms
     â†’ mockResponseSchema.parse.mockReturnValue is not a function
 â¯ src/modules/agent/session.integration.test.ts (46 tests | 44 failed) 1327ms
   Ã— Session Management Integration Tests > Session Creation and Initialization > should create a new session with proper defaults 46ms
     â†’ expected "spy" to be called at least once
   Ã— Session Management Integration Tests > Session Creation and Initialization > should initialize session with user context 14ms
     â†’ expected "spy" to be called at least once
   Ã— Session Management Integration Tests > Session Creation and Initialization > should handle session collision gracefully 18ms
     â†’ expected "spy" to be called at least once
   Ã— Session Management Integration Tests > Session Persistence and Recovery > should automatically save session state during conversation 26ms
     â†’ expected "spy" to be called at least once
   Ã— Session Management Integration Tests > Session Persistence and Recovery > should persist session to Redis with proper TTL 12ms
     â†’ expected "spy" to be called at least once
   Ã— Session Management Integration Tests > Session Persistence and Recovery > should recover session from persistent storage 11ms
     â†’ expected "spy" to be called at least once
   Ã— Session Management Integration Tests > Session Persistence and Recovery > should handle corrupted session data gracefully 11ms
     â†’ expected "spy" to be called at least once
   Ã— Session Management Integration Tests > Session History Management > should maintain conversation history within limits 18ms
     â†’ expected "spy" to be called at least once
   Ã— Session Management Integration Tests > Session History Management > should compress old conversation history 16ms
     â†’ expected "spy" to be called at least once
   Ã— Session Management Integration Tests > Session History Management > should handle concurrent session updates 16ms
     â†’ expected "spy" to be called at least once
   Ã— Session Management Integration Tests > Session Sharing and Collaboration > should enable session sharing between users 21ms
     â†’ expected "spy" to be called at least once
   Ã— Session Management Integration Tests > Session Sharing and Collaboration > should handle collaborative editing conflicts 23ms
     â†’ expected "spy" to be called at least once
   Ã— Session Management Integration Tests > Session Sharing and Collaboration > should track session activity from multiple participants 19ms
     â†’ expected "spy" to be called at least once
   Ã— Session Management Integration Tests > Session Analytics and Metrics > should track session usage metrics 22ms
     â†’ expected "spy" to be called at least once
   Ã— Session Management Integration Tests > Session Analytics and Metrics > should monitor session performance 62ms
     â†’ expected "spy" to be called at least once
   Ã— Session Management Integration Tests > Session Analytics and Metrics > should analyze conversation quality 31ms
     â†’ expected "spy" to be called at least once
   Ã— Session Management Integration Tests > Session Cleanup and Archival > should clean up expired sessions 20ms
     â†’ expected "spy" to be called at least once
   Ã— Session Management Integration Tests > Session Cleanup and Archival > should archive completed sessions 87ms
     â†’ expected "spy" to be called at least once
   Ã— Session Management Integration Tests > Session Cleanup and Archival > should compress archived session data 53ms
     â†’ expected "spy" to be called at least once
   Ã— Session Management Integration Tests > Session Security and Privacy > should sanitize sensitive data in session history 29ms
     â†’ expected "spy" to be called at least once
   Ã— Session Management Integration Tests > Session Security and Privacy > should enforce session access controls 19ms
     â†’ expected "spy" to be called at least once
   Ã— Session Management Integration Tests > Session Security and Privacy > should audit session access and modifications 27ms
     â†’ expected "spy" to be called at least once
   Ã— Session Management Integration Tests > Session Migration and Versioning > should migrate sessions between schema versions 23ms
     â†’ expected "spy" to be called at least once
   Ã— Session Management Integration Tests > Session Creation and Initialization > should create a new session with proper defaults 36ms
     â†’ expected "spy" to be called with arguments: [ ObjectContaining{â€¦} ][90m

Number of calls: [1m0[22m
[39m
   Ã— Session Management Integration Tests > Session Creation and Initialization > should initialize session with user context 19ms
     â†’ expected "spy" to be called with arguments: [ ObjectContaining{â€¦} ][90m

Number of calls: [1m0[22m
[39m
   Ã— Session Management Integration Tests > Session Creation and Initialization > should handle session collision gracefully 30ms
     â†’ expected "spy" to be called with arguments: [ 'session-test-123' ][90m

Number of calls: [1m0[22m
[39m
   Ã— Session Management Integration Tests > Session Persistence and Recovery > should automatically save session state during conversation 50ms
     â†’ expected "spy" to be called with arguments: [ ObjectContaining{â€¦} ][90m

Number of calls: [1m0[22m
[39m
   Ã— Session Management Integration Tests > Session Persistence and Recovery > should persist session to Redis with proper TTL 18ms
     â†’ expected "spy" to be called with arguments: [ 'session:session-test-123', â€¦(1) ][90m

Number of calls: [1m0[22m
[39m
   Ã— Session Management Integration Tests > Session Persistence and Recovery > should recover session from persistent storage 33ms
     â†’ expected "spy" to be called with arguments: [ 'session-test-123' ][90m

Number of calls: [1m0[22m
[39m
   Ã— Session Management Integration Tests > Session Persistence and Recovery > should handle corrupted session data gracefully 17ms
     â†’ expected "spy" to be called at least once
   Ã— Session Management Integration Tests > Session History Management > should maintain conversation history within limits 28ms
     â†’ Cannot read properties of undefined (reading '0')
   Ã— Session Management Integration Tests > Session History Management > should compress old conversation history 24ms
     â†’ expected "spy" to be called with arguments: [ ObjectContaining{â€¦} ][90m

Number of calls: [1m0[22m
[39m
   Ã— Session Management Integration Tests > Session History Management > should handle concurrent session updates 25ms
     â†’ expected "spy" to be called 2 times, but got 0 times
   Ã— Session Management Integration Tests > Session Sharing and Collaboration > should enable session sharing between users 22ms
     â†’ expected "spy" to be called with arguments: [ â€¦(2) ][90m

Number of calls: [1m0[22m
[39m
   Ã— Session Management Integration Tests > Session Sharing and Collaboration > should handle collaborative editing conflicts 24ms
     â†’ expected "spy" to be called at least once
   Ã— Session Management Integration Tests > Session Sharing and Collaboration > should track session activity from multiple participants 69ms
     â†’ expected "spy" to be called with arguments: [ â€¦(2) ][90m

Number of calls: [1m0[22m
[39m
   Ã— Session Management Integration Tests > Session Analytics and Metrics > should track session usage metrics 19ms
     â†’ expected "spy" to be called with arguments: [ 'session-test-123' ][90m

Number of calls: [1m0[22m
[39m
   Ã— Session Management Integration Tests > Session Analytics and Metrics > should monitor session performance 85ms
     â†’ expected "spy" to be called with arguments: [ 'metrics:session_performance', â€¦(1) ][90m

Number of calls: [1m0[22m
[39m
   Ã— Session Management Integration Tests > Session Analytics and Metrics > should analyze conversation quality 33ms
     â†’ expected "spy" to be called with arguments: [ â€¦(2) ][90m

Number of calls: [1m0[22m
[39m
   âœ“ Session Management Integration Tests > Session Cleanup and Archival > should clean up expired sessions 23ms
   Ã— Session Management Integration Tests > Session Cleanup and Archival > should archive completed sessions 25ms
     â†’ expected "spy" to be called with arguments: [ 'session-test-123', â€¦(1) ][90m

Number of calls: [1m0[22m
[39m
   Ã— Session Management Integration Tests > Session Cleanup and Archival > should compress archived session data 23ms
     â†’ expected "spy" to be called at least once
   Ã— Session Management Integration Tests > Session Security and Privacy > should sanitize sensitive data in session history 21ms
     â†’ Cannot read properties of undefined (reading '0')
   âœ“ Session Management Integration Tests > Session Security and Privacy > should enforce session access controls 24ms
   Ã— Session Management Integration Tests > Session Security and Privacy > should audit session access and modifications 20ms
     â†’ expected "spy" to be called with arguments: [ â€¦(2) ][90m

Number of calls: [1m0[22m
[39m
   Ã— Session Management Integration Tests > Session Migration and Versioning > should migrate sessions between schema versions 21ms
     â†’ expected "spy" to be called with arguments: [ ObjectContaining{â€¦} ][90m

Number of calls: [1m0[22m
[39m
 â¯ src/auth.jwt.lifecycle.integration.test.ts (16 tests | 1 failed) 274ms
   âœ“ Auth JWT Lifecycle Integration Tests > should generate valid JWT access tokens 41ms
   âœ“ Auth JWT Lifecycle Integration Tests > should generate valid JWT refresh tokens 11ms
   âœ“ Auth JWT Lifecycle Integration Tests > should handle token expiration correctly 22ms
   âœ“ Auth JWT Lifecycle Integration Tests > should validate token signatures correctly 8ms
   âœ“ Auth JWT Lifecycle Integration Tests > should handle malformed tokens 17ms
   âœ“ Auth JWT Lifecycle Integration Tests > should implement token refresh workflow 13ms
   âœ“ Auth JWT Lifecycle Integration Tests > should validate JWT claims correctly 7ms
   âœ“ Auth JWT Lifecycle Integration Tests > should reject tokens with invalid audience 9ms
   âœ“ Auth JWT Lifecycle Integration Tests > should reject tokens with invalid issuer 6ms
   âœ“ Auth JWT Lifecycle Integration Tests > should handle token blacklisting scenario 3ms
   âœ“ Auth JWT Lifecycle Integration Tests > should handle concurrent token operations 27ms
   âœ“ Auth JWT Lifecycle Integration Tests > should handle different token algorithms 5ms
   Ã— Auth JWT Lifecycle Integration Tests > should validate token timing claims 71ms
     â†’ expected [Function] to not throw an error but 'NotBeforeError: jwt not active' was thrown
   âœ“ Auth JWT Lifecycle Integration Tests > should handle token payload size limits 8ms
   âœ“ Auth JWT Lifecycle Integration Tests > should implement secure token rotation 11ms
   âœ“ Auth JWT Lifecycle Integration Tests > should handle JWT header manipulation detection 2ms
 â¯ src/postgres.advanced.integration.test.ts (10 tests | 10 failed) 396ms
   Ã— PostgreSQL Advanced Integration Tests > should establish connection to PostgreSQL 90ms
     â†’ SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string
     â†’ SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string
   Ã— PostgreSQL Advanced Integration Tests > should handle concurrent connections properly 43ms
     â†’ SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string
     â†’ SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string
   Ã— PostgreSQL Advanced Integration Tests > should handle transactions correctly 37ms
     â†’ SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string
     â†’ SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string
   Ã— PostgreSQL Advanced Integration Tests > should handle JSONB operations efficiently 37ms
     â†’ SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string
     â†’ SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string
   Ã— PostgreSQL Advanced Integration Tests > should handle connection pool exhaustion gracefully 30ms
     â†’ SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string
     â†’ SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string
   Ã— PostgreSQL Advanced Integration Tests > should handle prepared statements efficiently 25ms
     â†’ SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string
     â†’ SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string
   Ã— PostgreSQL Advanced Integration Tests > should handle large dataset operations 40ms
     â†’ SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string
     â†’ SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string
   Ã— PostgreSQL Advanced Integration Tests > should handle connection recovery after network issues 23ms
     â†’ SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string
     â†’ SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string
   Ã— PostgreSQL Advanced Integration Tests > should monitor pool statistics 33ms
     â†’ SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string
     â†’ SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string
   Ã— PostgreSQL Advanced Integration Tests > should handle database schema migrations 29ms
     â†’ SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string
     â†’ SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string
 â¯ src/security.input.validation.integration.test.ts (13 tests | 1 failed) 180ms
   âœ“ Security Input Validation Integration Tests > Schema Validation with Zod > should validate user input schemas correctly 40ms
   âœ“ Security Input Validation Integration Tests > Schema Validation with Zod > should validate agent configuration schemas 10ms
   âœ“ Security Input Validation Integration Tests > SQL Injection Prevention > should detect and prevent SQL injection attempts 10ms
   âœ“ Security Input Validation Integration Tests > SQL Injection Prevention > should validate database query parameters 4ms
   âœ“ Security Input Validation Integration Tests > XSS Prevention > should sanitize HTML content to prevent XSS 8ms
   âœ“ Security Input Validation Integration Tests > XSS Prevention > should validate and sanitize user-generated content 2ms
   âœ“ Security Input Validation Integration Tests > Input Length and Format Validation > should enforce input length limits 1ms
   âœ“ Security Input Validation Integration Tests > Input Length and Format Validation > should validate email and URL formats 3ms
   Ã— Security Input Validation Integration Tests > File Upload Validation > should validate file uploads securely 48ms
     â†’ expected true to be false // Object.is equality
   âœ“ Security Input Validation Integration Tests > File Upload Validation > should detect malicious file content patterns 3ms
   âœ“ Security Input Validation Integration Tests > API Rate Limiting Validation > should validate rate limiting parameters 3ms
   âœ“ Security Input Validation Integration Tests > Command Injection Prevention > should prevent command injection in system calls 14ms
   âœ“ Security Input Validation Integration Tests > Integer Overflow and Boundary Validation > should validate numeric boundaries correctly 17ms
 â¯ src/modules/agent/security.integration.test.ts (10 tests | 8 failed) 879ms
   Ã— Security and Validation Integration Tests > Input Sanitization > should sanitize malicious input prompts 42ms
     â†’ expected "spy" to be called at least once
   Ã— Security and Validation Integration Tests > Input Sanitization > should validate tool parameters for security 478ms
     â†’ The requested module 'pino' does not provide an export named 'Logger'
   Ã— Security and Validation Integration Tests > Authentication and Authorization > should enforce session-based access control 10ms
     â†’ expected "spy" to be called at least once
   Ã— Security and Validation Integration Tests > Authentication and Authorization > should validate API key permissions 31ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/llm/LlmKeyManager.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/security.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

   âœ“ Security and Validation Integration Tests > Data Protection > should redact sensitive information from logs 23ms
   Ã— Security and Validation Integration Tests > Data Protection > should implement secure session storage 19ms
     â†’ expected "spy" to be called with arguments: [ ObjectContaining{â€¦} ][90m

Number of calls: [1m0[22m
[39m
   âœ“ Security and Validation Integration Tests > Rate Limiting and DOS Protection > should enforce rate limits per user 134ms
   Ã— Security and Validation Integration Tests > Rate Limiting and DOS Protection > should detect and prevent abuse patterns 80ms
     â†’ expected "spy" to be called 10 times, but got 0 times
   Ã— Security and Validation Integration Tests > Error Handling and Information Disclosure > should not leak sensitive information in error messages 29ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/utils/llmProvider.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/security.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

   Ã— Security and Validation Integration Tests > Error Handling and Information Disclosure > should implement secure error logging 26ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/utils/llmProvider.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/security.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

 â¯ src/modules/agent/performance.integration.test.ts (7 tests | 3 failed) 610ms
   âœ“ Memory and Performance Integration Tests > Memory Management > should monitor memory usage during agent execution 18ms
   Ã— Memory and Performance Integration Tests > Memory Management > should handle memory pressure gracefully 399ms
     â†’ expected "spy" to be called at least once
   Ã— Memory and Performance Integration Tests > Memory Management > should implement memory cleanup after completion 11ms
     â†’ expected "spy" to be called at least once
   âœ“ Memory and Performance Integration Tests > Performance Benchmarks > should complete simple requests within performance thresholds 9ms
   âœ“ Memory and Performance Integration Tests > Performance Benchmarks > should handle concurrent agent instances efficiently 115ms
   Ã— Memory and Performance Integration Tests > Resource Optimization > should optimize conversation history storage 19ms
     â†’ expected "spy" to be called at least once
   âœ“ Memory and Performance Integration Tests > Resource Optimization > should implement efficient caching strategies 31ms
 â¯ src/modules/agent/e2e.integration.test.ts (8 tests | 8 failed) 750ms
   Ã— End-to-End Workflow Integration Tests > Complete Data Analysis Workflow > should execute complete data analysis pipeline 551ms
     â†’ The requested module 'pino' does not provide an export named 'Logger'
   Ã— End-to-End Workflow Integration Tests > Complete Data Analysis Workflow > should handle research and synthesis workflow 41ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/utils/llmProvider.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/e2e.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

   Ã— End-to-End Workflow Integration Tests > Multi-step Problem Solving > should solve complex problems requiring multiple iterations 23ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/utils/llmProvider.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/e2e.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

   Ã— End-to-End Workflow Integration Tests > Multi-step Problem Solving > should handle error recovery and alternative approaches 20ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/utils/llmProvider.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/e2e.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

   Ã— End-to-End Workflow Integration Tests > Session Continuity and State Management > should maintain context across conversation turns 28ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/utils/llmProvider.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/e2e.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

   Ã— End-to-End Workflow Integration Tests > Session Continuity and State Management > should handle session persistence and recovery 39ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/utils/llmProvider.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/e2e.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

   Ã— End-to-End Workflow Integration Tests > Integration with External Systems > should integrate with multiple external APIs 22ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/utils/llmProvider.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/e2e.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

   Ã— End-to-End Workflow Integration Tests > Integration with External Systems > should handle workflow orchestration across services 21ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/utils/llmProvider.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/e2e.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

 â¯ src/api.middleware.chain.integration.test.ts (27 tests | 27 skipped) 22ms
 â¯ src/api.cors.integration.test.ts (30 tests | 30 skipped) 22ms
 â¯ src/api.rate.limiting.integration.test.ts (19 tests | 19 skipped) 37ms
 â¯ src/api.streaming.integration.test.ts (11 tests | 11 skipped) 58ms
 â¯ src/api.integration.test.ts (15 tests | 15 skipped) 56ms
 âœ“ src/otel.tracing.integration.test.ts (12 tests) 338ms
 â¯ src/llm.provider.failover.integration.test.ts (6 tests | 1 failed) 315ms
   âœ“ LLM Provider Failover Integration Tests > should implement provider hierarchy with failover 55ms
   âœ“ LLM Provider Failover Integration Tests > should handle circuit breaker pattern 2ms
   Ã— LLM Provider Failover Integration Tests > should implement load balancing with weighted distribution 66ms
     â†’ expected 23 to be greater than 27
   âœ“ LLM Provider Failover Integration Tests > should handle provider health monitoring and auto-recovery 2ms
   âœ“ LLM Provider Failover Integration Tests > should implement request routing based on model capabilities 83ms
   âœ“ LLM Provider Failover Integration Tests > should handle provider cost optimization 103ms
 âœ“ src/modules/tools/definitions/browser/tools.browser.integration.test.ts (15 tests) 143ms
 âœ“ src/modules/agent/agent.integration.test.ts (10 tests) 23ms
 âœ“ src/webServer.integration.test.ts (1 test) 6ms
 âœ“ src/modules/agent/redis.integration.test.ts (21 tests) 100ms
 âœ“ src/redis.cluster.integration.test.ts (13 tests) 2378ms
   âœ“ Redis Cluster Integration Tests > should handle Redis expiration and TTL  2107ms
 â¯ src/modules/agent/websocket.integration.test.ts (21 tests | 12 failed) 6357ms
   Ã— WebSocket Real-time Communication Integration Tests > Real-time Agent Communication > should send real-time progress updates via WebSocket 89ms
     â†’ expected "spy" to be called 4 times, but got 0 times
   Ã— WebSocket Real-time Communication Integration Tests > Real-time Agent Communication > should stream agent thoughts in real-time 663ms
     â†’ The requested module 'pino' does not provide an export named 'Logger'
   Ã— WebSocket Real-time Communication Integration Tests > Real-time Agent Communication > should broadcast tool execution results in real-time 24ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/utils/llmProvider.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/websocket.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

   Ã— WebSocket Real-time Communication Integration Tests > Real-time Agent Communication > should handle real-time user interruptions 9ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/logger.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/websocket.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

   Ã— WebSocket Real-time Communication Integration Tests > Multi-client Collaboration > should broadcast session updates to all connected clients 17ms
     â†’ expected "spy" to be called with arguments: [ 'session-room', ObjectContaining{â€¦} ][90m

Number of calls: [1m0[22m
[39m
   Ã— WebSocket Real-time Communication Integration Tests > Multi-client Collaboration > should handle collaborative session editing 13ms
     â†’ expected "spy" to be called with arguments: [ ObjectContaining{â€¦}, â€¦(1) ][90m

Number of calls: [1m0[22m
[39m
   âœ“ WebSocket Real-time Communication Integration Tests > Multi-client Collaboration > should manage presence and typing indicators 12ms
   Ã— WebSocket Real-time Communication Integration Tests > Multi-client Collaboration > should synchronize canvas updates across clients 36ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/utils/llmProvider.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/websocket.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

   âœ“ WebSocket Real-time Communication Integration Tests > Connection Management and Reliability > should handle connection drops and reconnection 21ms
   âœ“ WebSocket Real-time Communication Integration Tests > Connection Management and Reliability > should implement heartbeat/ping-pong mechanism  371ms
   Ã— WebSocket Real-time Communication Integration Tests > Connection Management and Reliability > should handle connection timeouts gracefully 5015ms
     â†’ Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
   âœ“ WebSocket Real-time Communication Integration Tests > Connection Management and Reliability > should manage connection pooling and load balancing 7ms
   Ã— WebSocket Real-time Communication Integration Tests > Real-time Analytics and Monitoring > should track real-time connection metrics 9ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/redis/redisClient.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/websocket.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

   âœ“ WebSocket Real-time Communication Integration Tests > Real-time Analytics and Monitoring > should monitor message throughput and performance 7ms
   Ã— WebSocket Real-time Communication Integration Tests > Real-time Analytics and Monitoring > should detect and alert on connection anomalies 9ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/redis/redisClient.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/websocket.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

   âœ“ WebSocket Real-time Communication Integration Tests > Security and Authentication > should validate WebSocket authentication tokens 7ms
   Ã— WebSocket Real-time Communication Integration Tests > Security and Authentication > should enforce rate limiting on WebSocket connections 9ms
     â†’ Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/redis/redisClient.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/websocket.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

   Ã— WebSocket Real-time Communication Integration Tests > Security and Authentication > should sanitize and validate incoming messages 10ms
     â†’ expected true to be false // Object.is equality
   âœ“ WebSocket Real-time Communication Integration Tests > Security and Authentication > should implement message encryption for sensitive data 8ms
   âœ“ WebSocket Real-time Communication Integration Tests > WebSocket vs HTTP Performance Comparison > should demonstrate WebSocket efficiency over HTTP polling 8ms
   âœ“ WebSocket Real-time Communication Integration Tests > WebSocket vs HTTP Performance Comparison > should measure real-time latency improvements 9ms

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯ Failed Suites 7 âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯

 FAIL  src/api.cors.integration.test.ts > API CORS Integration Tests
TypeError: Missing parameter name at 13: https://git.new/pathToRegexpError
 â¯ name ../../node_modules/.pnpm/path-to-regexp@8.2.0/node_modules/path-to-regexp/src/index.ts:153:13
 â¯ lexer ../../node_modules/.pnpm/path-to-regexp@8.2.0/node_modules/path-to-regexp/src/index.ts:171:21
 â¯ Iter.peek ../../node_modules/.pnpm/path-to-regexp@8.2.0/node_modules/path-to-regexp/src/index.ts:188:32
 â¯ Iter.tryConsume ../../node_modules/.pnpm/path-to-regexp@8.2.0/node_modules/path-to-regexp/src/index.ts:195:24
 â¯ Iter.text ../../node_modules/.pnpm/path-to-regexp@8.2.0/node_modules/path-to-regexp/src/index.ts:213:26
 â¯ consume ../../node_modules/.pnpm/path-to-regexp@8.2.0/node_modules/path-to-regexp/src/index.ts:285:23
 â¯ parse ../../node_modules/.pnpm/path-to-regexp@8.2.0/node_modules/path-to-regexp/src/index.ts:320:18
 â¯ ../../node_modules/.pnpm/path-to-regexp@8.2.0/node_modules/path-to-regexp/src/index.ts:503:40

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[1/170]âŽ¯

 FAIL  src/api.integration.test.ts > API Integration Tests
 FAIL  src/api.streaming.integration.test.ts > API Streaming Integration Tests
error: password authentication failed for user "user"
 â¯ Parser.parseErrorMessage ../../node_modules/.pnpm/pg-protocol@1.10.3/node_modules/pg-protocol/src/parser.ts:369:69
 â¯ Parser.handlePacket ../../node_modules/.pnpm/pg-protocol@1.10.3/node_modules/pg-protocol/src/parser.ts:187:21
 â¯ Parser.parse ../../node_modules/.pnpm/pg-protocol@1.10.3/node_modules/pg-protocol/src/parser.ts:102:30
 â¯ Socket.<anonymous> ../../node_modules/.pnpm/pg-protocol@1.10.3/node_modules/pg-protocol/src/index.ts:7:48

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[2/170]âŽ¯

 FAIL  src/api.middleware.chain.integration.test.ts > API Middleware Chain Integration Tests
 FAIL  src/api.rate.limiting.integration.test.ts > API Rate Limiting Integration Tests
TypeError: Missing parameter name at 1: https://git.new/pathToRegexpError
 â¯ name ../../node_modules/.pnpm/path-to-regexp@8.2.0/node_modules/path-to-regexp/src/index.ts:153:13
 â¯ lexer ../../node_modules/.pnpm/path-to-regexp@8.2.0/node_modules/path-to-regexp/src/index.ts:171:21
 â¯ Iter.peek ../../node_modules/.pnpm/path-to-regexp@8.2.0/node_modules/path-to-regexp/src/index.ts:188:32
 â¯ Iter.tryConsume ../../node_modules/.pnpm/path-to-regexp@8.2.0/node_modules/path-to-regexp/src/index.ts:195:24
 â¯ Iter.text ../../node_modules/.pnpm/path-to-regexp@8.2.0/node_modules/path-to-regexp/src/index.ts:213:26
 â¯ consume ../../node_modules/.pnpm/path-to-regexp@8.2.0/node_modules/path-to-regexp/src/index.ts:285:23
 â¯ parse ../../node_modules/.pnpm/path-to-regexp@8.2.0/node_modules/path-to-regexp/src/index.ts:320:18
 â¯ ../../node_modules/.pnpm/path-to-regexp@8.2.0/node_modules/path-to-regexp/src/index.ts:503:40

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[3/170]âŽ¯

 FAIL  src/modules/agent/agent.critical.integration.test.ts [ src/modules/agent/agent.critical.integration.test.ts ]
Error: [vitest] No "getLogger" export is defined on the "../../logger.ts" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

vi[33m.[39m[34mmock[39m([35mimport[39m([32m"../../logger.ts"[39m)[33m,[39m [35masync[39m (importOriginal) [33m=>[39m {
  [35mconst[39m actual [33m=[39m [35mawait[39m [34mimportOriginal[39m()
  [35mreturn[39m {
    [33m...[39mactual[33m,[39m
    [90m// your mocked methods[39m
  }
})

 â¯ src/modules/redis/redisClient.ts:5:16
      3| import { getLogger } from '../../logger.ts';
      4| 
      5| const logger = getLogger();
       |                ^
      6| let redisClient: IORedis | null = null;
      7| 
 â¯ src/modules/llm/LlmKeyManager.ts:3:31

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[4/170]âŽ¯

 FAIL  src/modules/agent/toolRegistry.integration.test.ts [ src/modules/agent/toolRegistry.integration.test.ts ]
Error: [vitest] There was an error when mocking a module. If you are using "vi.mock" factory, make sure there are no top level variables inside, since this call is hoisted to top of the file. Read more: https://vitest.dev/api/vi.html#vi-mock
 â¯ src/utils/toolLoader.ts:7:31
      5| import { z } from 'zod';
      6| 
      7| import { getLogger } from '../logger.ts';
       |                               ^
      8| import { toolRegistry } from '../modules/tools/toolRegistry.ts';
      9| import { Tool } from '../types.ts';

Caused by: ReferenceError: Cannot access 'mockToolRegistry' before initialization
 â¯ src/modules/agent/toolRegistry.integration.test.ts:197:17
 â¯ src/utils/toolLoader.ts:7:31

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[5/170]âŽ¯


âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯ Failed Tests 153 âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯

 FAIL  src/auth.jwt.lifecycle.integration.test.ts > Auth JWT Lifecycle Integration Tests > should validate token timing claims
AssertionError: expected [Function] to not throw an error but 'NotBeforeError: jwt not active' was thrown

[32m- Expected:[39m 
undefined

[31m+ Received:[39m 
"NotBeforeError: jwt not active"

 â¯ src/auth.jwt.lifecycle.integration.test.ts:314:12
    312|     expect(() => {
    313|       jwt.verify(immediateToken, jwtSecret);
    314|     }).not.toThrow();
       |            ^
    315|   });
    316| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[6/170]âŽ¯

 FAIL  src/llm.provider.failover.integration.test.ts > LLM Provider Failover Integration Tests > should implement load balancing with weighted distribution
AssertionError: expected 23 to be greater than 27
 â¯ src/llm.provider.failover.integration.test.ts:375:36
    373| 
    374|     expect(fastProviderRequests).toBeGreaterThan(mediumProviderRequestâ€¦
    375|     expect(mediumProviderRequests).toBeGreaterThan(slowProviderRequestâ€¦
       |                                    ^
    376| 
    377|     // Should roughly match 50:30:20 ratio

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[7/170]âŽ¯

 FAIL  src/postgres.advanced.integration.test.ts > PostgreSQL Advanced Integration Tests > should establish connection to PostgreSQL
 FAIL  src/postgres.advanced.integration.test.ts > PostgreSQL Advanced Integration Tests > should handle concurrent connections properly
 FAIL  src/postgres.advanced.integration.test.ts > PostgreSQL Advanced Integration Tests > should handle transactions correctly
 FAIL  src/postgres.advanced.integration.test.ts > PostgreSQL Advanced Integration Tests > should handle JSONB operations efficiently
 FAIL  src/postgres.advanced.integration.test.ts > PostgreSQL Advanced Integration Tests > should handle connection pool exhaustion gracefully
 FAIL  src/postgres.advanced.integration.test.ts > PostgreSQL Advanced Integration Tests > should handle prepared statements efficiently
 FAIL  src/postgres.advanced.integration.test.ts > PostgreSQL Advanced Integration Tests > should handle large dataset operations
 FAIL  src/postgres.advanced.integration.test.ts > PostgreSQL Advanced Integration Tests > should handle connection recovery after network issues
 FAIL  src/postgres.advanced.integration.test.ts > PostgreSQL Advanced Integration Tests > should monitor pool statistics
 FAIL  src/postgres.advanced.integration.test.ts > PostgreSQL Advanced Integration Tests > should handle database schema migrations
Error: SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string
 â¯ ../../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11
 â¯ src/postgres.advanced.integration.test.ts:43:20
     41|   beforeEach(async () => {
     42|     // Setup test tables if needed
     43|     const client = await pool.connect();
       |                    ^
     44|     try {
     45|       await client.query(`

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[8/170]âŽ¯

 FAIL  src/postgres.advanced.integration.test.ts > PostgreSQL Advanced Integration Tests > should establish connection to PostgreSQL
 FAIL  src/postgres.advanced.integration.test.ts > PostgreSQL Advanced Integration Tests > should handle concurrent connections properly
 FAIL  src/postgres.advanced.integration.test.ts > PostgreSQL Advanced Integration Tests > should handle transactions correctly
 FAIL  src/postgres.advanced.integration.test.ts > PostgreSQL Advanced Integration Tests > should handle JSONB operations efficiently
 FAIL  src/postgres.advanced.integration.test.ts > PostgreSQL Advanced Integration Tests > should handle connection pool exhaustion gracefully
 FAIL  src/postgres.advanced.integration.test.ts > PostgreSQL Advanced Integration Tests > should handle prepared statements efficiently
 FAIL  src/postgres.advanced.integration.test.ts > PostgreSQL Advanced Integration Tests > should handle large dataset operations
 FAIL  src/postgres.advanced.integration.test.ts > PostgreSQL Advanced Integration Tests > should handle connection recovery after network issues
 FAIL  src/postgres.advanced.integration.test.ts > PostgreSQL Advanced Integration Tests > should monitor pool statistics
 FAIL  src/postgres.advanced.integration.test.ts > PostgreSQL Advanced Integration Tests > should handle database schema migrations
Error: SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string
 â¯ ../../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11
 â¯ src/postgres.advanced.integration.test.ts:61:20
     59|   afterEach(async () => {
     60|     // Cleanup test data
     61|     const client = await pool.connect();
       |                    ^
     62|     try {
     63|       await client.query('DELETE FROM test_sessions');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[9/170]âŽ¯

 FAIL  src/security.input.validation.integration.test.ts > Security Input Validation Integration Tests > File Upload Validation > should validate file uploads securely
AssertionError: expected true to be false // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- false[39m
[31m+ true[39m

 â¯ src/security.input.validation.integration.test.ts:407:32
    405|       maliciousFiles.forEach((file) => {
    406|         const result = FileUploadSchema.safeParse(file);
    407|         expect(result.success).toBe(false);
       |                                ^
    408|       });
    409|     });
 â¯ src/security.input.validation.integration.test.ts:405:22

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[10/170]âŽ¯

 FAIL  src/worker.concurrent.processing.integration.test.ts > Worker Concurrent Processing Integration Tests > should distribute jobs across workers concurrently
Error: No available workers
 â¯ assignJob src/worker.concurrent.processing.integration.test.ts:111:31
    109|       const availableWorker = workers.find((w) => !w.busy);
    110|       if (!availableWorker) {
    111|         return Promise.reject(new Error('No available workers'));
       |                               ^
    112|       }
    113| 
 â¯ src/worker.concurrent.processing.integration.test.ts:130:57
 â¯ src/worker.concurrent.processing.integration.test.ts:130:44

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[11/170]âŽ¯

 FAIL  src/worker.concurrent.processing.integration.test.ts > Worker Concurrent Processing Integration Tests > should handle worker failures gracefully
AssertionError: expected 'rejected' to be 'fulfilled' // Object.is equality

Expected: [32m"[7mfulfill[27med"[39m
Received: [31m"[7mreject[27med"[39m

 â¯ src/worker.concurrent.processing.integration.test.ts:201:31
    199|     expect(results[0].status).toBe('fulfilled');
    200|     expect(results[1].status).toBe('rejected');
    201|     expect(results[2].status).toBe('fulfilled');
       |                               ^
    202| 
    203|     // Check that one worker failed

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[12/170]âŽ¯

 FAIL  src/worker.concurrent.processing.integration.test.ts > Worker Concurrent Processing Integration Tests > should implement worker load balancing
Error: No available workers
 â¯ Object.assignJob src/worker.concurrent.processing.integration.test.ts:323:28
    321|       async assignJob(job: any): Promise<any> {
    322|         const worker = this.selectWorker();
    323|         if (!worker) throw new Error('No available workers');
       |                            ^
    324| 
    325|         worker.busy = true;
 â¯ src/worker.concurrent.processing.integration.test.ts:358:38
 â¯ src/worker.concurrent.processing.integration.test.ts:358:12

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[13/170]âŽ¯

 FAIL  src/modules/agent/e2e.integration.test.ts > End-to-End Workflow Integration Tests > Complete Data Analysis Workflow > should execute complete data analysis pipeline
 FAIL  src/modules/agent/jobQueue.integration.test.ts > Job Queue BullMQ Integration Tests > Job Retry and Error Handling > should retry failed jobs with exponential backoff
 FAIL  src/modules/agent/llm.qwen.integration.test.ts > Qwen LLM Provider Integration Tests > Qwen Basic Integration > should handle Qwen API key validation
 FAIL  src/modules/agent/llmProvider.integration.test.ts > LLM Provider Fallback Integration Tests > Provider Recovery and Auto-healing > should perform health checks on recovered providers
 FAIL  src/modules/agent/monitoring.integration.test.ts > Monitoring and Observability Integration Tests > Metrics Collection > should track LLM provider performance metrics
 FAIL  src/modules/agent/security.integration.test.ts > Security and Validation Integration Tests > Input Sanitization > should validate tool parameters for security
 FAIL  src/modules/agent/websocket.integration.test.ts > WebSocket Real-time Communication Integration Tests > Real-time Agent Communication > should stream agent thoughts in real-time
SyntaxError: The requested module 'pino' does not provide an export named 'Logger'
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[14/170]âŽ¯

 FAIL  src/modules/agent/e2e.integration.test.ts > End-to-End Workflow Integration Tests > Complete Data Analysis Workflow > should handle research and synthesis workflow
 FAIL  src/modules/agent/e2e.integration.test.ts > End-to-End Workflow Integration Tests > Multi-step Problem Solving > should solve complex problems requiring multiple iterations
 FAIL  src/modules/agent/e2e.integration.test.ts > End-to-End Workflow Integration Tests > Multi-step Problem Solving > should handle error recovery and alternative approaches
 FAIL  src/modules/agent/e2e.integration.test.ts > End-to-End Workflow Integration Tests > Session Continuity and State Management > should maintain context across conversation turns
 FAIL  src/modules/agent/e2e.integration.test.ts > End-to-End Workflow Integration Tests > Session Continuity and State Management > should handle session persistence and recovery
 FAIL  src/modules/agent/e2e.integration.test.ts > End-to-End Workflow Integration Tests > Integration with External Systems > should integrate with multiple external APIs
 FAIL  src/modules/agent/e2e.integration.test.ts > End-to-End Workflow Integration Tests > Integration with External Systems > should handle workflow orchestration across services
Error: Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/utils/llmProvider.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/e2e.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[15/170]âŽ¯

 FAIL  src/modules/agent/jobQueue.integration.test.ts > Job Queue BullMQ Integration Tests > Job Creation and Processing > should process job with proper progress updates
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/jobQueue.integration.test.ts:211:38
    209|       const result = await agent.run();
    210| 
    211|       expect(mockJob.updateProgress).toHaveBeenCalled();
       |                                      ^
    212|       expect(result).toBe('Job queue test response');
    213|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[16/170]âŽ¯

 FAIL  src/modules/agent/jobQueue.integration.test.ts > Job Queue BullMQ Integration Tests > Job Creation and Processing > should handle high-priority jobs first
AssertionError: expected "spy" to be called with arguments: [ [ 'waiting', 'active' ], +0, 100 ][90m

Number of calls: [1m0[22m
[39m
 â¯ src/modules/agent/jobQueue.integration.test.ts:236:33
    234| 
    235|       // Les jobs haute prioritÃ© devraient Ãªtre traitÃ©s en premier
    236|       expect(mockQueue.getJobs).toHaveBeenCalledWith(
       |                                 ^
    237|         ['waiting', 'active'],
    238|         0,

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[17/170]âŽ¯

 FAIL  src/modules/agent/jobQueue.integration.test.ts > Job Queue BullMQ Integration Tests > Job Retry and Error Handling > should move job to failed queue after max retries
 FAIL  src/modules/agent/jobQueue.integration.test.ts > Job Queue BullMQ Integration Tests > Job Retry and Error Handling > should handle job timeout gracefully
Error: Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/utils/llmProvider.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/jobQueue.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[18/170]âŽ¯

 FAIL  src/modules/agent/jobQueue.integration.test.ts > Job Queue BullMQ Integration Tests > Job Retry and Error Handling > should provide detailed error diagnostics for failed jobs
SyntaxError: TypeScript parameter property is not supported in strip-only mode
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[19/170]âŽ¯

 FAIL  src/modules/agent/jobQueue.integration.test.ts > Job Queue BullMQ Integration Tests > Job Queue Management > should monitor queue health and metrics
 FAIL  src/modules/agent/jobQueue.integration.test.ts > Job Queue BullMQ Integration Tests > Queue Events and Monitoring > should monitor queue performance metrics
 FAIL  src/modules/agent/jobQueue.integration.test.ts > Job Queue BullMQ Integration Tests > Queue Events and Monitoring > should alert on queue anomalies
Error: Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/redis/redisClient.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/jobQueue.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[20/170]âŽ¯

 FAIL  src/modules/agent/jobQueue.integration.test.ts > Job Queue BullMQ Integration Tests > Job Queue Management > should handle queue overflow and backpressure
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/jobQueue.integration.test.ts:529:38
    527| 
    528|       // Le systÃ¨me devrait implÃ©menter une logique de backpressure
    529|       expect(mockQueue.getJobCounts).toHaveBeenCalled();
       |                                      ^
    530|     });
    531| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[21/170]âŽ¯

 FAIL  src/modules/agent/jobQueue.integration.test.ts > Job Queue BullMQ Integration Tests > Repeatable and Scheduled Jobs > should manage repeatable job lifecycle
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/jobQueue.integration.test.ts:600:43
    598|       await agent.run();
    599| 
    600|       expect(mockQueue.getRepeatableJobs).toHaveBeenCalled();
       |                                           ^
    601| 
    602|       // Test de suppression d'un job rÃ©pÃ©table

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22/170]âŽ¯

 FAIL  src/modules/agent/jobQueue.integration.test.ts > Job Queue BullMQ Integration Tests > Queue Scaling and Load Balancing > should scale workers based on queue load
AssertionError: expected 1 to be greater than 3
 â¯ src/modules/agent/jobQueue.integration.test.ts:852:31
    850|       );
    851| 
    852|       expect(requiredWorkers).toBeGreaterThan(currentLoad.activeWorkerâ€¦
       |                               ^
    853| 
    854|       // Simuler l'ajout de workers

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[23/170]âŽ¯

 FAIL  src/modules/agent/llm.qwen.integration.test.ts > Qwen LLM Provider Integration Tests > Qwen Basic Integration > should successfully get response from Qwen provider
TypeError: mockResponseSchema.parse.mockReturnValue is not a function
 â¯ src/modules/agent/llm.qwen.integration.test.ts:167:32
    165|         '{"answer": "Qwen successful response"}',
    166|       );
    167|       mockResponseSchema.parse.mockReturnValue({
       |                                ^
    168|         answer: 'Qwen successful response',
    169|       });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[24/170]âŽ¯

 FAIL  src/modules/agent/llm.qwen.integration.test.ts > Qwen LLM Provider Integration Tests > Qwen Basic Integration > should handle missing Qwen API key gracefully
 FAIL  src/modules/agent/llm.qwen.integration.test.ts > Qwen LLM Provider Integration Tests > Qwen Error Handling > should handle Qwen API authentication errors
Error: Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/llm/LlmKeyManager.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/llm.qwen.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[25/170]âŽ¯

 FAIL  src/modules/agent/llm.qwen.integration.test.ts > Qwen LLM Provider Integration Tests > Qwen Error Handling > should handle Qwen rate limiting errors
TypeError: mockResponseSchema.parse.mockReturnValue is not a function
 â¯ src/modules/agent/llm.qwen.integration.test.ts:231:32
    229|         '{"answer": "Gemini after rate limit"}',
    230|       );
    231|       mockResponseSchema.parse.mockReturnValue({
       |                                ^
    232|         answer: 'Gemini after rate limit',
    233|       });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[26/170]âŽ¯

 FAIL  src/modules/agent/llm.qwen.integration.test.ts > Qwen LLM Provider Integration Tests > Qwen Error Handling > should handle Qwen timeout errors with retries
TypeError: mockResponseSchema.parse.mockReturnValue is not a function
 â¯ src/modules/agent/llm.qwen.integration.test.ts:253:32
    251|         .mockRejectedValueOnce(qwenTimeoutError)
    252|         .mockResolvedValueOnce('{"answer": "Qwen timeout retry successâ€¦
    253|       mockResponseSchema.parse.mockReturnValue({
       |                                ^
    254|         answer: 'Qwen timeout retry success',
    255|       });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[27/170]âŽ¯

 FAIL  src/modules/agent/llm.qwen.integration.test.ts > Qwen LLM Provider Integration Tests > Qwen Error Handling > should handle Qwen service unavailable errors
TypeError: mockResponseSchema.parse.mockReturnValue is not a function
 â¯ src/modules/agent/llm.qwen.integration.test.ts:296:32
    294|         '{"answer": "Gemini service backup"}',
    295|       );
    296|       mockResponseSchema.parse.mockReturnValue({
       |                                ^
    297|         answer: 'Gemini service backup',
    298|       });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[28/170]âŽ¯

 FAIL  src/modules/agent/llm.qwen.integration.test.ts > Qwen LLM Provider Integration Tests > Qwen Model Selection and Configuration > should work with different Qwen model variants
TypeError: mockResponseSchema.parse.mockReturnValue is not a function
 â¯ src/modules/agent/llm.qwen.integration.test.ts:323:34
    321|           `{"answer": "Response from ${model}"}`,
    322|         );
    323|         mockResponseSchema.parse.mockReturnValue({
       |                                  ^
    324|           answer: `Response from ${model}`,
    325|         });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[29/170]âŽ¯

 FAIL  src/modules/agent/llm.qwen.integration.test.ts > Qwen LLM Provider Integration Tests > Qwen Model Selection and Configuration > should respect Qwen temperature and token limits
TypeError: mockResponseSchema.parse.mockReturnValue is not a function
 â¯ src/modules/agent/llm.qwen.integration.test.ts:354:32
    352|         '{"answer": "Configured Qwen response"}',
    353|       );
    354|       mockResponseSchema.parse.mockReturnValue({
       |                                ^
    355|         answer: 'Configured Qwen response',
    356|       });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[30/170]âŽ¯

 FAIL  src/modules/agent/llm.qwen.integration.test.ts > Qwen LLM Provider Integration Tests > Qwen Model Selection and Configuration > should handle Qwen streaming responses
TypeError: mockResponseSchema.parse.mockReturnValue is not a function
 â¯ src/modules/agent/llm.qwen.integration.test.ts:410:32
    408|       });
    409| 
    410|       mockResponseSchema.parse.mockReturnValue({
       |                                ^
    411|         answer: 'Streaming response from Qwen',
    412|       });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[31/170]âŽ¯

 FAIL  src/modules/agent/llm.qwen.integration.test.ts > Qwen LLM Provider Integration Tests > Qwen Performance and Monitoring > should monitor Qwen response times
TypeError: mockResponseSchema.parse.mockReturnValue is not a function
 â¯ src/modules/agent/llm.qwen.integration.test.ts:431:32
    429|           ),
    430|       );
    431|       mockResponseSchema.parse.mockReturnValue({ answer: 'Qwen timing â€¦
       |                                ^
    432| 
    433|       const startTime = Date.now();

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[32/170]âŽ¯

 FAIL  src/modules/agent/llm.qwen.integration.test.ts > Qwen LLM Provider Integration Tests > Qwen Performance and Monitoring > should track Qwen token usage
TypeError: mockResponseSchema.parse.mockReturnValue is not a function
 â¯ src/modules/agent/llm.qwen.integration.test.ts:456:32
    454|         '{"answer": "Token usage tracking"}',
    455|       );
    456|       mockResponseSchema.parse.mockReturnValue({
       |                                ^
    457|         answer: 'Token usage tracking',
    458|       });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[33/170]âŽ¯

 FAIL  src/modules/agent/llm.qwen.integration.test.ts > Qwen LLM Provider Integration Tests > Qwen Performance and Monitoring > should implement Qwen health checks
Error: request for '../../config.ts' is not in cache
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[34/170]âŽ¯

 FAIL  src/modules/agent/llm.qwen.integration.test.ts > Qwen LLM Provider Integration Tests > Qwen Context and Memory Management > should handle long conversation context with Qwen
TypeError: mockResponseSchema.parse.mockReturnValue is not a function
 â¯ src/modules/agent/llm.qwen.integration.test.ts:509:32
    507|         '{"answer": "Qwen long context response"}',
    508|       );
    509|       mockResponseSchema.parse.mockReturnValue({
       |                                ^
    510|         answer: 'Qwen long context response',
    511|       });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[35/170]âŽ¯

 FAIL  src/modules/agent/llm.qwen.integration.test.ts > Qwen LLM Provider Integration Tests > Qwen Context and Memory Management > should optimize context window for Qwen models
TypeError: mockResponseSchema.parse.mockReturnValue is not a function
 â¯ src/modules/agent/llm.qwen.integration.test.ts:546:32
    544|         '{"answer": "Qwen optimized context"}',
    545|       );
    546|       mockResponseSchema.parse.mockReturnValue({
       |                                ^
    547|         answer: 'Qwen optimized context',
    548|       });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[36/170]âŽ¯

 FAIL  src/modules/agent/llm.qwen.integration.test.ts > Qwen LLM Provider Integration Tests > Qwen Cost Optimization > should track Qwen usage costs
TypeError: mockResponseSchema.parse.mockReturnValue is not a function
 â¯ src/modules/agent/llm.qwen.integration.test.ts:578:32
    576|         '{"answer": "Cost tracking test"}',
    577|       );
    578|       mockResponseSchema.parse.mockReturnValue({
       |                                ^
    579|         answer: 'Cost tracking test',
    580|       });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[37/170]âŽ¯

 FAIL  src/modules/agent/llm.qwen.integration.test.ts > Qwen LLM Provider Integration Tests > Qwen Cost Optimization > should prefer Qwen for cost-effective operations
TypeError: mockResponseSchema.parse.mockReturnValue is not a function
 â¯ src/modules/agent/llm.qwen.integration.test.ts:600:32
    598|         '{"answer": "Qwen cost-effective"}',
    599|       );
    600|       mockResponseSchema.parse.mockReturnValue({
       |                                ^
    601|         answer: 'Qwen cost-effective',
    602|       });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[38/170]âŽ¯

 FAIL  src/modules/agent/llmProvider.integration.test.ts > LLM Provider Fallback Integration Tests > Provider Failover Scenarios > should fallback from OpenAI to Anthropic on error
TypeError: mockResponseSchema.parse.mockReturnValue is not a function
 â¯ src/modules/agent/llmProvider.integration.test.ts:181:32
    179|         '{"answer": "Anthropic response"}',
    180|       );
    181|       mockResponseSchema.parse.mockReturnValue({
       |                                ^
    182|         answer: 'Anthropic response',
    183|       });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39/170]âŽ¯

 FAIL  src/modules/agent/llmProvider.integration.test.ts > LLM Provider Fallback Integration Tests > Provider Failover Scenarios > should cascade through all providers on sequential failures
TypeError: mockResponseSchema.parse.mockReturnValue is not a function
 â¯ src/modules/agent/llmProvider.integration.test.ts:210:32
    208|         '{"answer": "GPT5 backup response"}',
    209|       );
    210|       mockResponseSchema.parse.mockReturnValue({
       |                                ^
    211|         answer: 'GPT5 backup response',
    212|       });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[40/170]âŽ¯

 FAIL  src/modules/agent/llmProvider.integration.test.ts > LLM Provider Fallback Integration Tests > Provider Failover Scenarios > should handle Qwen timeout errors with specific retry logic
TypeError: mockResponseSchema.parse.mockReturnValue is not a function
 â¯ src/modules/agent/llmProvider.integration.test.ts:243:32
    241|         .mockRejectedValueOnce(qwenTimeoutError)
    242|         .mockResolvedValueOnce('{"answer": "Qwen retry success"}');
    243|       mockResponseSchema.parse.mockReturnValue({
       |                                ^
    244|         answer: 'Qwen retry success',
    245|       });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[41/170]âŽ¯

 FAIL  src/modules/agent/llmProvider.integration.test.ts > LLM Provider Fallback Integration Tests > Provider Failover Scenarios > should handle all providers failing gracefully
AssertionError: expected 'Agent run failed: this.log.child is nâ€¦' to contain 'All LLM providers failed'

Expected: [32m"A[7mll LLM providers failed[27m"[39m
Received: [31m"A[7mgent run failed: this.log.child is not a function[27m"[39m

 â¯ src/modules/agent/llmProvider.integration.test.ts:270:22
    268|       const result = await agent.run();
    269| 
    270|       expect(result).toContain('All LLM providers failed');
       |                      ^
    271|       expect(mockOpenAIProvider.getLlmResponse).toHaveBeenCalled();
    272|       expect(mockAnthropicProvider.getLlmResponse).toHaveBeenCalled();

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[42/170]âŽ¯

 FAIL  src/modules/agent/llmProvider.integration.test.ts > LLM Provider Fallback Integration Tests > Provider Health Monitoring > should monitor provider response times
TypeError: mockResponseSchema.parse.mockReturnValue is not a function
 â¯ src/modules/agent/llmProvider.integration.test.ts:290:32
    288|           ),
    289|       );
    290|       mockResponseSchema.parse.mockReturnValue({ answer: 'Fast responsâ€¦
       |                                ^
    291| 
    292|       const startTime = Date.now();

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[43/170]âŽ¯

 FAIL  src/modules/agent/llmProvider.integration.test.ts > LLM Provider Fallback Integration Tests > Provider Health Monitoring > should track provider error rates
TypeError: mockResponseSchema.parse.mockReturnValue is not a function
 â¯ src/modules/agent/llmProvider.integration.test.ts:313:32
    311|         return Promise.resolve('{"answer": "Eventually successful"}');
    312|       });
    313|       mockResponseSchema.parse.mockReturnValue({
       |                                ^
    314|         answer: 'Eventually successful',
    315|       });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[44/170]âŽ¯

 FAIL  src/modules/agent/llmProvider.integration.test.ts > LLM Provider Fallback Integration Tests > Provider Health Monitoring > should implement circuit breaker pattern for unhealthy providers
TypeError: mockResponseSchema.parse.mockReturnValue is not a function
 â¯ src/modules/agent/llmProvider.integration.test.ts:333:32
    331|         '{"answer": "Anthropic healthy"}',
    332|       );
    333|       mockResponseSchema.parse.mockReturnValue({ answer: 'Anthropic heâ€¦
       |                                ^
    334| 
    335|       // Premier appel - devrait essayer OpenAI puis Anthropic

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[45/170]âŽ¯

 FAIL  src/modules/agent/llmProvider.integration.test.ts > LLM Provider Fallback Integration Tests > Provider Load Balancing > should distribute load across healthy providers
TypeError: mockResponseSchema.parse.mockReturnValue is not a function
 â¯ src/modules/agent/llmProvider.integration.test.ts:373:32
    371|         '{"answer": "Qwen response"}',
    372|       );
    373|       mockResponseSchema.parse.mockReturnValue({
       |                                ^
    374|         answer: 'Load balanced response',
    375|       });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[46/170]âŽ¯

 FAIL  src/modules/agent/llmProvider.integration.test.ts > LLM Provider Fallback Integration Tests > Provider Load Balancing > should respect provider priority in hierarchy
TypeError: mockResponseSchema.parse.mockReturnValue is not a function
 â¯ src/modules/agent/llmProvider.integration.test.ts:409:32
    407|         '{"answer": "OpenAI priority"}',
    408|       );
    409|       mockResponseSchema.parse.mockReturnValue({ answer: 'OpenAI priorâ€¦
       |                                ^
    410| 
    411|       const result = await agent.run();

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[47/170]âŽ¯

 FAIL  src/modules/agent/llmProvider.integration.test.ts > LLM Provider Fallback Integration Tests > Provider Load Balancing > should handle provider capacity limits
TypeError: mockResponseSchema.parse.mockReturnValue is not a function
 â¯ src/modules/agent/llmProvider.integration.test.ts:429:32
    427|         '{"answer": "Anthropic capacity available"}',
    428|       );
    429|       mockResponseSchema.parse.mockReturnValue({
       |                                ^
    430|         answer: 'Anthropic capacity available',
    431|       });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[48/170]âŽ¯

 FAIL  src/modules/agent/llmProvider.integration.test.ts > LLM Provider Fallback Integration Tests > Provider Recovery and Auto-healing > should automatically recover failed providers
TypeError: mockResponseSchema.parse.mockReturnValue is not a function
 â¯ src/modules/agent/llmProvider.integration.test.ts:449:32
    447|         .mockRejectedValueOnce(new LlmError('Temporary failure'))
    448|         .mockResolvedValueOnce('{"answer": "OpenAI recovered"}');
    449|       mockResponseSchema.parse.mockReturnValue({ answer: 'OpenAI recovâ€¦
       |                                ^
    450| 
    451|       await agent.run();

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[49/170]âŽ¯

 FAIL  src/modules/agent/llmProvider.integration.test.ts > LLM Provider Fallback Integration Tests > Provider Recovery and Auto-healing > should gradually increase traffic to recovered providers
TypeError: mockResponseSchema.parse.mockReturnValue is not a function
 â¯ src/modules/agent/llmProvider.integration.test.ts:486:32
    484|         '{"answer": "Anthropic stable"}',
    485|       );
    486|       mockResponseSchema.parse.mockReturnValue({ answer: 'Recovery tesâ€¦
       |                                ^
    487| 
    488|       // Plusieurs appels pour tester la rÃ©cupÃ©ration progressive

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[50/170]âŽ¯

 FAIL  src/modules/agent/llmProvider.integration.test.ts > LLM Provider Fallback Integration Tests > Provider-Specific Error Handling > should handle OpenAI-specific errors correctly
TypeError: mockResponseSchema.parse.mockReturnValue is not a function
 â¯ src/modules/agent/llmProvider.integration.test.ts:519:32
    517|         '{"answer": "Anthropic fallback"}',
    518|       );
    519|       mockResponseSchema.parse.mockReturnValue({
       |                                ^
    520|         answer: 'Anthropic fallback',
    521|       });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[51/170]âŽ¯

 FAIL  src/modules/agent/llmProvider.integration.test.ts > LLM Provider Fallback Integration Tests > Provider-Specific Error Handling > should handle Anthropic-specific errors correctly
TypeError: mockResponseSchema.parse.mockReturnValue is not a function
 â¯ src/modules/agent/llmProvider.integration.test.ts:542:32
    540|         '{"answer": "Qwen alternative"}',
    541|       );
    542|       mockResponseSchema.parse.mockReturnValue({ answer: 'Qwen alternaâ€¦
       |                                ^
    543| 
    544|       const result = await agent.run();

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[52/170]âŽ¯

 FAIL  src/modules/agent/llmProvider.integration.test.ts > LLM Provider Fallback Integration Tests > Provider-Specific Error Handling > should handle provider authentication failures
Error: Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/llm/LlmKeyManager.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/llmProvider.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[53/170]âŽ¯

 FAIL  src/modules/agent/llmProvider.integration.test.ts > LLM Provider Fallback Integration Tests > Cost Optimization > should prefer cost-effective providers when possible
TypeError: mockResponseSchema.parse.mockReturnValue is not a function
 â¯ src/modules/agent/llmProvider.integration.test.ts:595:32
    593|         '{"answer": "Qwen cost-effective"}',
    594|       );
    595|       mockResponseSchema.parse.mockReturnValue({ answer: 'Cost optimizâ€¦
       |                                ^
    596| 
    597|       // Simuler la sÃ©lection du provider le moins cher

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[54/170]âŽ¯

 FAIL  src/modules/agent/llmProvider.integration.test.ts > LLM Provider Fallback Integration Tests > Cost Optimization > should track token usage and costs per provider
TypeError: mockResponseSchema.parse.mockReturnValue is not a function
 â¯ src/modules/agent/llmProvider.integration.test.ts:619:32
    617|         '{"answer": "Token usage tracking"}',
    618|       );
    619|       mockResponseSchema.parse.mockReturnValue({
       |                                ^
    620|         answer: 'Token usage tracking',
    621|       });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[55/170]âŽ¯

 FAIL  src/modules/agent/monitoring.integration.test.ts > Monitoring and Observability Integration Tests > Metrics Collection > should collect agent execution metrics
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/monitoring.integration.test.ts:136:46
    134|       // Verify metrics are collected
    135|       expect(executionTime).toBeGreaterThan(0);
    136|       expect(mockSessionManager.saveSession).toHaveBeenCalled();
       |                                              ^
    137|     });
    138| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[56/170]âŽ¯

 FAIL  src/modules/agent/monitoring.integration.test.ts > Monitoring and Observability Integration Tests > Metrics Collection > should monitor tool execution statistics
 FAIL  src/modules/agent/monitoring.integration.test.ts > Monitoring and Observability Integration Tests > Health Monitoring > should detect and report degraded performance
 FAIL  src/modules/agent/monitoring.integration.test.ts > Monitoring and Observability Integration Tests > Error Tracking and Alerting > should track and categorize errors
 FAIL  src/modules/agent/monitoring.integration.test.ts > Monitoring and Observability Integration Tests > Error Tracking and Alerting > should generate alerts for critical failures
Error: Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/utils/llmProvider.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/monitoring.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[57/170]âŽ¯

 FAIL  src/modules/agent/monitoring.integration.test.ts > Monitoring and Observability Integration Tests > Distributed Tracing > should create distributed traces for agent workflows
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/monitoring.integration.test.ts:180:39
    178| 
    179|       // Verify tracing calls
    180|       expect(mockTelemetry.startSpan).toHaveBeenCalled();
       |                                       ^
    181|     });
    182| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[58/170]âŽ¯

 FAIL  src/modules/agent/monitoring.integration.test.ts > Monitoring and Observability Integration Tests > Distributed Tracing > should trace cross-service communications
 FAIL  src/modules/agent/monitoring.integration.test.ts > Monitoring and Observability Integration Tests > Performance Analytics > should analyze conversation quality metrics
 FAIL  src/modules/agent/monitoring.integration.test.ts > Monitoring and Observability Integration Tests > Real-time Dashboards and Visualization > should provide real-time metrics for dashboards
 FAIL  src/modules/agent/monitoring.integration.test.ts > Monitoring and Observability Integration Tests > Real-time Dashboards and Visualization > should stream metrics to visualization tools
 FAIL  src/modules/agent/monitoring.integration.test.ts > Monitoring and Observability Integration Tests > Compliance and Audit Logging > should maintain detailed audit trails
Error: Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/redis/redisClient.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/monitoring.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[59/170]âŽ¯

 FAIL  src/modules/agent/monitoring.integration.test.ts > Monitoring and Observability Integration Tests > Distributed Tracing > should correlate traces across agent instances
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/monitoring.integration.test.ts:205:46
    203| 
    204|       await tracedAgent.run();
    205|       expect(mockSessionManager.saveSession).toHaveBeenCalled();
       |                                              ^
    206|     });
    207|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[60/170]âŽ¯

 FAIL  src/modules/agent/monitoring.integration.test.ts > Monitoring and Observability Integration Tests > Health Monitoring > should report agent health status
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/monitoring.integration.test.ts:224:46
    222|       await agent.run();
    223| 
    224|       expect(mockSessionManager.saveSession).toHaveBeenCalled();
       |                                              ^
    225|     });
    226| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[61/170]âŽ¯

 FAIL  src/modules/agent/monitoring.integration.test.ts > Monitoring and Observability Integration Tests > Error Tracking and Alerting > should implement error rate monitoring
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/monitoring.integration.test.ts:299:46
    297| 
    298|       await agent.run();
    299|       expect(mockSessionManager.saveSession).toHaveBeenCalled();
       |                                              ^
    300|     });
    301|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[62/170]âŽ¯

 FAIL  src/modules/agent/performance.integration.test.ts > Memory and Performance Integration Tests > Memory Management > should handle memory pressure gracefully
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/performance.integration.test.ts:130:46
    128| 
    129|       await agent.run();
    130|       expect(mockSessionManager.saveSession).toHaveBeenCalled();
       |                                              ^
    131|     });
    132| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[63/170]âŽ¯

 FAIL  src/modules/agent/performance.integration.test.ts > Memory and Performance Integration Tests > Memory Management > should implement memory cleanup after completion
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/performance.integration.test.ts:136:46
    134|       await agent.run();
    135|       // Verify cleanup occurs (simplified mock verification)
    136|       expect(mockSessionManager.saveSession).toHaveBeenCalled();
       |                                              ^
    137|     });
    138|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[64/170]âŽ¯

 FAIL  src/modules/agent/performance.integration.test.ts > Memory and Performance Integration Tests > Resource Optimization > should optimize conversation history storage
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/performance.integration.test.ts:191:46
    189| 
    190|       // Verify optimization occurred
    191|       expect(mockSessionManager.saveSession).toHaveBeenCalled();
       |                                              ^
    192|     });
    193| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[65/170]âŽ¯

 FAIL  src/modules/agent/security.integration.test.ts > Security and Validation Integration Tests > Input Sanitization > should sanitize malicious input prompts
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/security.integration.test.ts:109:48
    107| 
    108|         await testAgent.run();
    109|         expect(mockSessionManager.saveSession).toHaveBeenCalled();
       |                                                ^
    110|       }
    111|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[66/170]âŽ¯

 FAIL  src/modules/agent/security.integration.test.ts > Security and Validation Integration Tests > Authentication and Authorization > should enforce session-based access control
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/security.integration.test.ts:159:46
    157| 
    158|       await restrictedAgent.run();
    159|       expect(mockSessionManager.saveSession).toHaveBeenCalled();
       |                                              ^
    160|     });
    161| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[67/170]âŽ¯

 FAIL  src/modules/agent/security.integration.test.ts > Security and Validation Integration Tests > Authentication and Authorization > should validate API key permissions
Error: Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/llm/LlmKeyManager.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/security.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[68/170]âŽ¯

 FAIL  src/modules/agent/security.integration.test.ts > Security and Validation Integration Tests > Data Protection > should implement secure session storage
AssertionError: expected "spy" to be called with arguments: [ ObjectContaining{â€¦} ][90m

Number of calls: [1m0[22m
[39m
 â¯ src/modules/agent/security.integration.test.ts:204:46
    202|       await agent.run();
    203| 
    204|       expect(mockSessionManager.saveSession).toHaveBeenCalledWith(
       |                                              ^
    205|         expect.objectContaining({
    206|           history: expect.any(Array),

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[69/170]âŽ¯

 FAIL  src/modules/agent/security.integration.test.ts > Security and Validation Integration Tests > Rate Limiting and DOS Protection > should detect and prevent abuse patterns
AssertionError: expected "spy" to be called 10 times, but got 0 times
 â¯ src/modules/agent/security.integration.test.ts:252:46
    250|       }
    251| 
    252|       expect(mockSessionManager.saveSession).toHaveBeenCalledTimes(10);
       |                                              ^
    253|     });
    254|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[70/170]âŽ¯

 FAIL  src/modules/agent/security.integration.test.ts > Security and Validation Integration Tests > Error Handling and Information Disclosure > should not leak sensitive information in error messages
 FAIL  src/modules/agent/security.integration.test.ts > Security and Validation Integration Tests > Error Handling and Information Disclosure > should implement secure error logging
Error: Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/utils/llmProvider.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/security.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[71/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Creation and Initialization > should create a new session with proper defaults
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/session.integration.test.ts:212:46
    210|       console.log('saveSession call count:', mockSessionManager.saveSeâ€¦
    211|       
    212|       expect(mockSessionManager.saveSession).toHaveBeenCalled();
       |                                              ^
    213|     });
    214| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[72/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Creation and Initialization > should initialize session with user context
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/session.integration.test.ts:231:46
    229|       await testAgent.run();
    230|       
    231|       expect(mockSessionManager.saveSession).toHaveBeenCalled();
       |                                              ^
    232|     });
    233| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[73/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Creation and Initialization > should handle session collision gracefully
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/session.integration.test.ts:251:45
    249|       
    250|       // VÃ©rifier que getSession est appelÃ©
    251|       expect(mockSessionManager.getSession).toHaveBeenCalled();
       |                                             ^
    252|     });
    253|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[74/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Persistence and Recovery > should automatically save session state during conversation
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/session.integration.test.ts:272:46
    270|       await testAgent.run();
    271|       
    272|       expect(mockSessionManager.saveSession).toHaveBeenCalled();
       |                                              ^
    273|     });
    274| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[75/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Persistence and Recovery > should persist session to Redis with proper TTL
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/session.integration.test.ts:291:36
    289|       await testAgent.run();
    290|       
    291|       expect(mockRedisClient.hset).toHaveBeenCalled();
       |                                    ^
    292|     });
    293| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[76/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Persistence and Recovery > should recover session from persistent storage
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/session.integration.test.ts:311:45
    309|       
    310|       // VÃ©rifier que getSession est appelÃ©
    311|       expect(mockSessionManager.getSession).toHaveBeenCalled();
       |                                             ^
    312|     });
    313| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[77/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Persistence and Recovery > should handle corrupted session data gracefully
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/session.integration.test.ts:330:48
    328|       await testAgent.run();
    329|       
    330|       expect(mockSessionManager.createSession).toHaveBeenCalled();
       |                                                ^
    331|     });
    332|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[78/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session History Management > should maintain conversation history within limits
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/session.integration.test.ts:351:46
    349|       await testAgent.run();
    350|       
    351|       expect(mockSessionManager.saveSession).toHaveBeenCalled();
       |                                              ^
    352|     });
    353| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[79/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session History Management > should compress old conversation history
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/session.integration.test.ts:370:46
    368|       await testAgent.run();
    369|       
    370|       expect(mockSessionManager.saveSession).toHaveBeenCalled();
       |                                              ^
    371|     });
    372| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[80/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session History Management > should handle concurrent session updates
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/session.integration.test.ts:391:46
    389|       await testAgent.run();
    390|       
    391|       expect(mockSessionManager.lockSession).toHaveBeenCalled();
       |                                              ^
    392|     });
    393|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[81/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Sharing and Collaboration > should enable session sharing between users
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/session.integration.test.ts:412:39
    410|       await testAgent.run();
    411|       
    412|       expect(mockRedisClient.publish).toHaveBeenCalled();
       |                                       ^
    413|     });
    414| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[82/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Sharing and Collaboration > should handle collaborative editing conflicts
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/session.integration.test.ts:431:47
    429|       await testAgent.run();
    430|       
    431|       expect(mockSessionManager.mergeSession).toHaveBeenCalled();
       |                                               ^
    432|     });
    433| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[83/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Sharing and Collaboration > should track session activity from multiple participants
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/session.integration.test.ts:450:36
    448|       await testAgent.run();
    449|       
    450|       expect(mockRedisClient.hset).toHaveBeenCalled();
       |                                    ^
    451|     });
    452|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[84/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Analytics and Metrics > should track session usage metrics
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/session.integration.test.ts:471:52
    469|       await testAgent.run();
    470|       
    471|       expect(mockSessionManager.getSessionMetrics).toHaveBeenCalled();
       |                                                    ^
    472|     });
    473| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[85/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Analytics and Metrics > should monitor session performance
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/session.integration.test.ts:490:39
    488|       await testAgent.run();
    489|       
    490|       expect(mockRedisClient.publish).toHaveBeenCalled();
       |                                       ^
    491|     });
    492| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[86/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Analytics and Metrics > should analyze conversation quality
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/session.integration.test.ts:509:36
    507|       await testAgent.run();
    508|       
    509|       expect(mockRedisClient.hset).toHaveBeenCalled();
       |                                    ^
    510|     });
    511|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[87/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Cleanup and Archival > should clean up expired sessions
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/session.integration.test.ts:530:57
    528|       await testAgent.run();
    529|       
    530|       expect(mockSessionManager.cleanupExpiredSessions).toHaveBeenCallâ€¦
       |                                                         ^
    531|     });
    532| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[88/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Cleanup and Archival > should archive completed sessions
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/session.integration.test.ts:549:49
    547|       await testAgent.run();
    548|       
    549|       expect(mockSessionManager.archiveSession).toHaveBeenCalled();
       |                                                 ^
    550|     });
    551| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[89/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Cleanup and Archival > should compress archived session data
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/session.integration.test.ts:568:49
    566|       await testAgent.run();
    567|       
    568|       expect(mockSessionManager.archiveSession).toHaveBeenCalled();
       |                                                 ^
    569|     });
    570|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[90/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Security and Privacy > should sanitize sensitive data in session history
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/session.integration.test.ts:589:46
    587|       await testAgent.run();
    588|       
    589|       expect(mockSessionManager.saveSession).toHaveBeenCalled();
       |                                              ^
    590|     });
    591| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[91/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Security and Privacy > should enforce session access controls
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/session.integration.test.ts:609:46
    607|       
    608|       // VÃ©rifier que les contrÃ´les d'accÃ¨s sont appliquÃ©s (via saveSeâ€¦
    609|       expect(mockSessionManager.saveSession).toHaveBeenCalled();
       |                                              ^
    610|     });
    611| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[92/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Security and Privacy > should audit session access and modifications
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/session.integration.test.ts:628:36
    626|       await testAgent.run();
    627|       
    628|       expect(mockRedisClient.hset).toHaveBeenCalled();
       |                                    ^
    629|     });
    630|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[93/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Migration and Versioning > should migrate sessions between schema versions
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/session.integration.test.ts:649:46
    647|       await testAgent.run();
    648|       
    649|       expect(mockSessionManager.saveSession).toHaveBeenCalled();
       |                                              ^
    650|     });
    651|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[94/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Creation and Initialization > should create a new session with proper defaults
AssertionError: expected "spy" to be called with arguments: [ ObjectContaining{â€¦} ][90m

Number of calls: [1m0[22m
[39m
 â¯ src/modules/agent/session.integration.test.ts:723:48
    721|       await newAgent.run();
    722| 
    723|       expect(mockSessionManager.createSession).toHaveBeenCalledWith(
       |                                                ^
    724|         expect.objectContaining({
    725|           createdAt: expect.any(Number),

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[95/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Creation and Initialization > should initialize session with user context
AssertionError: expected "spy" to be called with arguments: [ ObjectContaining{â€¦} ][90m

Number of calls: [1m0[22m
[39m
 â¯ src/modules/agent/session.integration.test.ts:751:46
    749|       await contextualAgent.run();
    750| 
    751|       expect(mockSessionManager.saveSession).toHaveBeenCalledWith(
       |                                              ^
    752|         expect.objectContaining({
    753|           userContext: contextData,

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[96/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Creation and Initialization > should handle session collision gracefully
AssertionError: expected "spy" to be called with arguments: [ 'session-test-123' ][90m

Number of calls: [1m0[22m
[39m
 â¯ src/modules/agent/session.integration.test.ts:768:45
    766|       await agent.run();
    767| 
    768|       expect(mockSessionManager.getSession).toHaveBeenCalledWith(
       |                                             ^
    769|         'session-test-123',
    770|       );

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[97/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Persistence and Recovery > should automatically save session state during conversation
AssertionError: expected "spy" to be called with arguments: [ ObjectContaining{â€¦} ][90m

Number of calls: [1m0[22m
[39m
 â¯ src/modules/agent/session.integration.test.ts:778:46
    776|       await agent.run();
    777| 
    778|       expect(mockSessionManager.saveSession).toHaveBeenCalledWith(
       |                                              ^
    779|         expect.objectContaining({
    780|           history: expect.any(Array),

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[98/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Persistence and Recovery > should persist session to Redis with proper TTL
AssertionError: expected "spy" to be called with arguments: [ 'session:session-test-123', â€¦(1) ][90m

Number of calls: [1m0[22m
[39m
 â¯ src/modules/agent/session.integration.test.ts:790:36
    788|       await agent.run();
    789| 
    790|       expect(mockRedisClient.hset).toHaveBeenCalledWith(
       |                                    ^
    791|         'session:session-test-123',
    792|         expect.objectContaining({

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[99/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Persistence and Recovery > should recover session from persistent storage
AssertionError: expected "spy" to be called with arguments: [ 'session-test-123' ][90m

Number of calls: [1m0[22m
[39m
 â¯ src/modules/agent/session.integration.test.ts:844:45
    842|       await recoveredAgent.run();
    843| 
    844|       expect(mockSessionManager.getSession).toHaveBeenCalledWith(
       |                                             ^
    845|         'session-test-123',
    846|       );

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[100/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Persistence and Recovery > should handle corrupted session data gracefully
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/session.integration.test.ts:868:48
    866|       await agent.run();
    867| 
    868|       expect(mockSessionManager.createSession).toHaveBeenCalled();
       |                                                ^
    869|     });
    870|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[101/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session History Management > should maintain conversation history within limits
TypeError: Cannot read properties of undefined (reading '0')
 â¯ src/modules/agent/session.integration.test.ts:893:71
    891|       await agentWithLargeHistory.run();
    892| 
    893|       const savedSession = mockSessionManager.saveSession.mock.calls[0â€¦
       |                                                                       ^
    894|       expect(savedSession.history.length).toBeLessThanOrEqual(1000); /â€¦
    895|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[102/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session History Management > should compress old conversation history
AssertionError: expected "spy" to be called with arguments: [ ObjectContaining{â€¦} ][90m

Number of calls: [1m0[22m
[39m
 â¯ src/modules/agent/session.integration.test.ts:916:46
    914|       await agentWithOldHistory.run();
    915| 
    916|       expect(mockSessionManager.saveSession).toHaveBeenCalledWith(
       |                                              ^
    917|         expect.objectContaining({
    918|           compressedHistory: expect.any(String),

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[103/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session History Management > should handle concurrent session updates
AssertionError: expected "spy" to be called 2 times, but got 0 times
 â¯ src/modules/agent/session.integration.test.ts:951:46
    949|       await Promise.all([agent1.run(), agent2.run()]);
    950| 
    951|       expect(mockSessionManager.lockSession).toHaveBeenCalledTimes(2);
       |                                              ^
    952|       expect(mockSessionManager.unlockSession).toHaveBeenCalledTimes(2â€¦
    953|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[104/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Sharing and Collaboration > should enable session sharing between users
AssertionError: expected "spy" to be called with arguments: [ â€¦(2) ][90m

Number of calls: [1m0[22m
[39m
 â¯ src/modules/agent/session.integration.test.ts:978:39
    976|       await sharedAgent.run();
    977| 
    978|       expect(mockRedisClient.publish).toHaveBeenCalledWith(
       |                                       ^
    979|         'session:shared:session-test-123',
    980|         expect.stringContaining('conversation_update'),

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[105/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Sharing and Collaboration > should handle collaborative editing conflicts
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/session.integration.test.ts:1005:47
    1003|       await collaborativeAgent.run();
    1004| 
    1005|       expect(mockSessionManager.mergeSession).toHaveBeenCalled();
       |                                               ^
    1006|     });
    1007| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[106/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Sharing and Collaboration > should track session activity from multiple participants
AssertionError: expected "spy" to be called with arguments: [ â€¦(2) ][90m

Number of calls: [1m0[22m
[39m
 â¯ src/modules/agent/session.integration.test.ts:1028:36
    1026|       await multiUserAgent.run();
    1027| 
    1028|       expect(mockRedisClient.hset).toHaveBeenCalledWith(
       |                                    ^
    1029|         'session_participants:session-test-123',
    1030|         expect.any(Object),

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[107/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Analytics and Metrics > should track session usage metrics
AssertionError: expected "spy" to be called with arguments: [ 'session-test-123' ][90m

Number of calls: [1m0[22m
[39m
 â¯ src/modules/agent/session.integration.test.ts:1039:52
    1037|       await agent.run();
    1038| 
    1039|       expect(mockSessionManager.getSessionMetrics).toHaveBeenCalledWitâ€¦
       |                                                    ^
    1040|         'session-test-123',
    1041|       );

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[108/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Analytics and Metrics > should monitor session performance
AssertionError: expected "spy" to be called with arguments: [ 'metrics:session_performance', â€¦(1) ][90m

Number of calls: [1m0[22m
[39m
 â¯ src/modules/agent/session.integration.test.ts:1055:39
    1053|       const duration = endTime - startTime;
    1054| 
    1055|       expect(mockRedisClient.publish).toHaveBeenCalledWith(
       |                                       ^
    1056|         'metrics:session_performance',
    1057|         expect.stringContaining(duration.toString()),

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[109/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Analytics and Metrics > should analyze conversation quality
AssertionError: expected "spy" to be called with arguments: [ â€¦(2) ][90m

Number of calls: [1m0[22m
[39m
 â¯ src/modules/agent/session.integration.test.ts:1071:36
    1069|       await agent.run();
    1070| 
    1071|       expect(mockRedisClient.hset).toHaveBeenCalledWith(
       |                                    ^
    1072|         'session_quality:session-test-123',
    1073|         expect.objectContaining({

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[110/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Cleanup and Archival > should archive completed sessions
AssertionError: expected "spy" to be called with arguments: [ 'session-test-123', â€¦(1) ][90m

Number of calls: [1m0[22m
[39m
 â¯ src/modules/agent/session.integration.test.ts:1118:49
    1116|       await completedAgent.run();
    1117| 
    1118|       expect(mockSessionManager.archiveSession).toHaveBeenCalledWith(
       |                                                 ^
    1119|         'session-test-123',
    1120|         expect.objectContaining({

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[111/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Cleanup and Archival > should compress archived session data
AssertionError: expected "spy" to be called at least once
 â¯ src/modules/agent/session.integration.test.ts:1161:49
    1159|       await largeAgent.run();
    1160| 
    1161|       expect(mockSessionManager.archiveSession).toHaveBeenCalled();
       |                                                 ^
    1162|     });
    1163|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[112/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Security and Privacy > should sanitize sensitive data in session history
TypeError: Cannot read properties of undefined (reading '0')
 â¯ src/modules/agent/session.integration.test.ts:1193:71
    1191|       await sensitiveAgent.run();
    1192| 
    1193|       const savedSession = mockSessionManager.saveSession.mock.calls[0â€¦
       |                                                                       ^
    1194|       const savedContent = savedSession.history
    1195|         .map((msg: Message) => {

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[113/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Security and Privacy > should audit session access and modifications
AssertionError: expected "spy" to be called with arguments: [ â€¦(2) ][90m

Number of calls: [1m0[22m
[39m
 â¯ src/modules/agent/session.integration.test.ts:1237:36
    1235|       await agent.run();
    1236| 
    1237|       expect(mockRedisClient.hset).toHaveBeenCalledWith(
       |                                    ^
    1238|         'session_audit:session-test-123',
    1239|         expect.objectContaining({

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[114/170]âŽ¯

 FAIL  src/modules/agent/session.integration.test.ts > Session Management Integration Tests > Session Migration and Versioning > should migrate sessions between schema versions
AssertionError: expected "spy" to be called with arguments: [ ObjectContaining{â€¦} ][90m

Number of calls: [1m0[22m
[39m
 â¯ src/modules/agent/session.integration.test.ts:1294:46
    1292|       await migrationAgent.run();
    1293| 
    1294|       expect(mockSessionManager.saveSession).toHaveBeenCalledWith(
       |                                              ^
    1295|         expect.objectContaining({
    1296|           history: expect.any(Array),

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[115/170]âŽ¯

 FAIL  src/modules/agent/websocket.integration.test.ts > WebSocket Real-time Communication Integration Tests > Real-time Agent Communication > should send real-time progress updates via WebSocket
AssertionError: expected "spy" to be called 4 times, but got 0 times
 â¯ src/modules/agent/websocket.integration.test.ts:273:34
    271|       await agent.run();
    272| 
    273|       expect(mockWebSocket.send).toHaveBeenCalledTimes(4);
       |                                  ^
    274|       expect(mockWebSocket.send).toHaveBeenLastCalledWith(
    275|         expect.stringContaining('agent_progress'),

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[116/170]âŽ¯

 FAIL  src/modules/agent/websocket.integration.test.ts > WebSocket Real-time Communication Integration Tests > Real-time Agent Communication > should broadcast tool execution results in real-time
 FAIL  src/modules/agent/websocket.integration.test.ts > WebSocket Real-time Communication Integration Tests > Multi-client Collaboration > should synchronize canvas updates across clients
Error: Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/utils/llmProvider.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/websocket.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[117/170]âŽ¯

 FAIL  src/modules/agent/websocket.integration.test.ts > WebSocket Real-time Communication Integration Tests > Real-time Agent Communication > should handle real-time user interruptions
Error: Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/logger.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/websocket.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[118/170]âŽ¯

 FAIL  src/modules/agent/websocket.integration.test.ts > WebSocket Real-time Communication Integration Tests > Multi-client Collaboration > should broadcast session updates to all connected clients
AssertionError: expected "spy" to be called with arguments: [ 'session-room', ObjectContaining{â€¦} ][90m

Number of calls: [1m0[22m
[39m
 â¯ src/modules/agent/websocket.integration.test.ts:444:46
    442| 
    443|       // VÃ©rifier que la mise Ã  jour est diffusÃ©e Ã  tous les clients
    444|       expect(mockWebSocketServer.sendToRoom).toHaveBeenCalledWith(
       |                                              ^
    445|         'session-room',
    446|         expect.objectContaining({

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[119/170]âŽ¯

 FAIL  src/modules/agent/websocket.integration.test.ts > WebSocket Real-time Communication Integration Tests > Multi-client Collaboration > should handle collaborative session editing
AssertionError: expected "spy" to be called with arguments: [ ObjectContaining{â€¦}, â€¦(1) ][90m

Number of calls: [1m0[22m
[39m
 â¯ src/modules/agent/websocket.integration.test.ts:491:45
    489| 
    490|       // VÃ©rifier que l'Ã©dition est diffusÃ©e aux autres clients
    491|       expect(mockWebSocketServer.broadcast).toHaveBeenCalledWith(
       |                                             ^
    492|         expect.objectContaining({
    493|           edit: collaborativeEdit.edit,

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[120/170]âŽ¯

 FAIL  src/modules/agent/websocket.integration.test.ts > WebSocket Real-time Communication Integration Tests > Connection Management and Reliability > should handle connection timeouts gracefully
Error: Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 â¯ src/modules/agent/websocket.integration.test.ts:651:5
    649|     });
    650| 
    651|     it('should handle connection timeouts gracefully', async () => {
       |     ^
    652|       const connectionTimeout = 5000; // 5 seconds
    653|       let timeoutTriggered = false;

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[121/170]âŽ¯

 FAIL  src/modules/agent/websocket.integration.test.ts > WebSocket Real-time Communication Integration Tests > Real-time Analytics and Monitoring > should track real-time connection metrics
 FAIL  src/modules/agent/websocket.integration.test.ts > WebSocket Real-time Communication Integration Tests > Real-time Analytics and Monitoring > should detect and alert on connection anomalies
 FAIL  src/modules/agent/websocket.integration.test.ts > WebSocket Real-time Communication Integration Tests > Security and Authentication > should enforce rate limiting on WebSocket connections
Error: Unexpected module status 0. Cannot require() ES Module /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/redis/redisClient.ts because it is not yet fully loaded. This may be caused by a race condition if the module is simultaneously dynamically import()-ed via Promise.all(). Try await-ing the import() sequentially in a loop instead. (from /home/demon/agentforge/AgenticForge2/AgenticForge/packages/core/src/modules/agent/websocket.integration.test.ts)
This is caused by either a bug in Node.js or incorrect usage of Node.js internals.
Please open an issue with this stack trace at https://github.com/nodejs/node/issues

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[122/170]âŽ¯

 FAIL  src/modules/agent/websocket.integration.test.ts > WebSocket Real-time Communication Integration Tests > Security and Authentication > should sanitize and validate incoming messages
AssertionError: expected true to be false // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- false[39m
[31m+ true[39m

 â¯ src/modules/agent/websocket.integration.test.ts:890:24
    888|       incomingMessages.forEach((msg) => {
    889|         const isSafe = sanitizeMessage(msg.content);
    890|         expect(isSafe).toBe(msg.safe);
       |                        ^
    891|       });
    892| 
 â¯ src/modules/agent/websocket.integration.test.ts:888:24

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[123/170]âŽ¯

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯ Unhandled Errors âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯

Vitest caught 1 unhandled error during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯ Uncaught Exception âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
AssertionError: expected "spy" to be called at least once
 â¯ Proxy.<anonymous> ../../node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1335:10
 â¯ Proxy.<anonymous> ../../node_modules/.pnpm/@vitest+expect@3.2.4/node_modules/@vitest/expect/dist/index.js:1029:14
 â¯ Proxy.methodWrapper ../../node_modules/.pnpm/chai@5.2.1/node_modules/chai/chai.js:1706:25
 â¯ Timeout._onTimeout src/modules/agent/session.integration.test.ts:1093:59
    1091|       // Simuler le nettoyage pÃ©riodique
    1092|       setTimeout(() => {
    1093|         expect(mockSessionManager.cleanupExpiredSessions).toHaveBeenCaâ€¦
       |                                                           ^
    1094|       }, 100);
    1095|     });
 â¯ listOnTimeout node:internal/timers:608:17
 â¯ processTimers node:internal/timers:543:7

This error originated in "src/modules/agent/session.integration.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯


 Test Files  21 failed | 6 passed (27)
      Tests  153 failed | 144 passed | 102 skipped (399)
     Errors  1 error
   Start at  18:02:14
   Duration  8.26s (transform 3.14s, setup 987ms, collect 10.46s, tests 20.31s, environment 14ms, prepare 6.27s)

â€‰ELIFECYCLEâ€‰ Command failed with exit code 1.
